
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://samgeo.gishub.org/common/">
      
      
        <link rel="prev" href="../workshops/cn_workshop/">
      
      
        <link rel="next" href="../samgeo/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>common module - segment-geospatial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#common-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="segment-geospatial" class="md-header__button md-logo" aria-label="segment-geospatial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            segment-geospatial
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              common module
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/opengeos/segment-geospatial" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="segment-geospatial" class="md-nav__button md-logo" aria-label="segment-geospatial" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    segment-geospatial
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/opengeos/segment-geospatial" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/opengeos/segment-geospatial/issues" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report Issues
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/satellite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Satellite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/automatic_mask_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic mask generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/automatic_mask_generator_hq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic mask generator hq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/input_prompts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/input_prompts_hq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input prompts hq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/box_prompts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Box prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/text_prompts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/text_prompts_batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text prompts batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/fast_sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fast sam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/swimming_pools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swimming pools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/arcgis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arcgis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/maxar_open_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maxar open data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workshops
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Workshops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/purdue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Purdue
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workshops/cn_workshop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cn workshop
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    common module
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    common module
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#samgeo.common" class="md-nav__link">
    <span class="md-ellipsis">
      samgeo.common
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.array_to_image" class="md-nav__link">
    <span class="md-ellipsis">
      array_to_image()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.bbox_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      bbox_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.blend_images" class="md-nav__link">
    <span class="md-ellipsis">
      blend_images()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.boxes_to_vector" class="md-nav__link">
    <span class="md-ellipsis">
      boxes_to_vector()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.check_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      check_file_path()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.coords_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      coords_to_geojson()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.coords_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      coords_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      download_checkpoint()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_checkpoint_legacy" class="md-nav__link">
    <span class="md-ellipsis">
      download_checkpoint_legacy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_files" class="md-nav__link">
    <span class="md-ellipsis">
      download_files()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.extract_archive" class="md-nav__link">
    <span class="md-ellipsis">
      extract_archive()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.geojson_to_coords" class="md-nav__link">
    <span class="md-ellipsis">
      geojson_to_coords()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.geojson_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      geojson_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_basemaps" class="md-nav__link">
    <span class="md-ellipsis">
      get_basemaps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_vector_crs" class="md-nav__link">
    <span class="md-ellipsis">
      get_vector_crs()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_xyz_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_xyz_dict()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.github_raw_url" class="md-nav__link">
    <span class="md-ellipsis">
      github_raw_url()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.image_to_cog" class="md-nav__link">
    <span class="md-ellipsis">
      image_to_cog()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.install_package" class="md-nav__link">
    <span class="md-ellipsis">
      install_package()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.is_colab" class="md-nav__link">
    <span class="md-ellipsis">
      is_colab()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.merge_rasters" class="md-nav__link">
    <span class="md-ellipsis">
      merge_rasters()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.overlay_images" class="md-nav__link">
    <span class="md-ellipsis">
      overlay_images()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.random_string" class="md-nav__link">
    <span class="md-ellipsis">
      random_string()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_geojson()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_gpkg" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_gpkg()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_shp" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_shp()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_vector" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_vector()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.regularize" class="md-nav__link">
    <span class="md-ellipsis">
      regularize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.reproject" class="md-nav__link">
    <span class="md-ellipsis">
      reproject()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.rowcol_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      rowcol_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.sam_map_gui" class="md-nav__link">
    <span class="md-ellipsis">
      sam_map_gui()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.show_canvas" class="md-nav__link">
    <span class="md-ellipsis">
      show_canvas()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.split_raster" class="md-nav__link">
    <span class="md-ellipsis">
      split_raster()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.temp_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      temp_file_path()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.text_sam_gui" class="md-nav__link">
    <span class="md-ellipsis">
      text_sam_gui()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.tms_to_geotiff" class="md-nav__link">
    <span class="md-ellipsis">
      tms_to_geotiff()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.transform_coords" class="md-nav__link">
    <span class="md-ellipsis">
      transform_coords()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.update_package" class="md-nav__link">
    <span class="md-ellipsis">
      update_package()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.vector_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      vector_to_geojson()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../samgeo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    samgeo module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fast_sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fast_sam module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hq_sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hq_sam module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../text_sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    text_sam module
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#samgeo.common" class="md-nav__link">
    <span class="md-ellipsis">
      samgeo.common
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.array_to_image" class="md-nav__link">
    <span class="md-ellipsis">
      array_to_image()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.bbox_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      bbox_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.blend_images" class="md-nav__link">
    <span class="md-ellipsis">
      blend_images()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.boxes_to_vector" class="md-nav__link">
    <span class="md-ellipsis">
      boxes_to_vector()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.check_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      check_file_path()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.coords_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      coords_to_geojson()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.coords_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      coords_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      download_checkpoint()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_checkpoint_legacy" class="md-nav__link">
    <span class="md-ellipsis">
      download_checkpoint_legacy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_file" class="md-nav__link">
    <span class="md-ellipsis">
      download_file()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.download_files" class="md-nav__link">
    <span class="md-ellipsis">
      download_files()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.extract_archive" class="md-nav__link">
    <span class="md-ellipsis">
      extract_archive()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.geojson_to_coords" class="md-nav__link">
    <span class="md-ellipsis">
      geojson_to_coords()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.geojson_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      geojson_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_basemaps" class="md-nav__link">
    <span class="md-ellipsis">
      get_basemaps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_vector_crs" class="md-nav__link">
    <span class="md-ellipsis">
      get_vector_crs()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.get_xyz_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_xyz_dict()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.github_raw_url" class="md-nav__link">
    <span class="md-ellipsis">
      github_raw_url()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.image_to_cog" class="md-nav__link">
    <span class="md-ellipsis">
      image_to_cog()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.install_package" class="md-nav__link">
    <span class="md-ellipsis">
      install_package()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.is_colab" class="md-nav__link">
    <span class="md-ellipsis">
      is_colab()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.merge_rasters" class="md-nav__link">
    <span class="md-ellipsis">
      merge_rasters()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.overlay_images" class="md-nav__link">
    <span class="md-ellipsis">
      overlay_images()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.random_string" class="md-nav__link">
    <span class="md-ellipsis">
      random_string()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_geojson()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_gpkg" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_gpkg()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_shp" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_shp()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.raster_to_vector" class="md-nav__link">
    <span class="md-ellipsis">
      raster_to_vector()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.regularize" class="md-nav__link">
    <span class="md-ellipsis">
      regularize()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.reproject" class="md-nav__link">
    <span class="md-ellipsis">
      reproject()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.rowcol_to_xy" class="md-nav__link">
    <span class="md-ellipsis">
      rowcol_to_xy()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.sam_map_gui" class="md-nav__link">
    <span class="md-ellipsis">
      sam_map_gui()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.show_canvas" class="md-nav__link">
    <span class="md-ellipsis">
      show_canvas()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.split_raster" class="md-nav__link">
    <span class="md-ellipsis">
      split_raster()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.temp_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      temp_file_path()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.text_sam_gui" class="md-nav__link">
    <span class="md-ellipsis">
      text_sam_gui()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.tms_to_geotiff" class="md-nav__link">
    <span class="md-ellipsis">
      tms_to_geotiff()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.transform_coords" class="md-nav__link">
    <span class="md-ellipsis">
      transform_coords()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.update_package" class="md-nav__link">
    <span class="md-ellipsis">
      update_package()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#samgeo.common.vector_to_geojson" class="md-nav__link">
    <span class="md-ellipsis">
      vector_to_geojson()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  

  
  


<h1 id="common-module">common module<a class="headerlink" href="#common-module" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="samgeo.common"></a>
    <div class="doc doc-contents first">

      <p>The source code is adapted from https://github.com/aliaksandr960/segment-anything-eo. Credit to the author Aliaksandr Hancharenka.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.array_to_image" class="doc doc-heading">
<code class="highlight language-python"><span class="n">array_to_image</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="s1">&#39;deflate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.array_to_image" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Save a NumPy array as a GeoTIFF using the projection information from an existing GeoTIFF file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>array</code></td>
        <td><code>np.ndarray</code></td>
        <td><p>The NumPy array to be saved as a GeoTIFF.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the output image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>The path to an existing GeoTIFF file with map projection information. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>dtype</code></td>
        <td><code>np.dtype</code></td>
        <td><p>The data type of the output array. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>compress</code></td>
        <td><code>str</code></td>
        <td><p>The compression method. Can be one of the following: "deflate", "lzw", "packbits", "jpeg". Defaults to "deflate".</p></td>
        <td><code>&#39;deflate&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">array_to_image</span><span class="p">(</span>
    <span class="n">array</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="s2">&quot;deflate&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a NumPy array as a GeoTIFF using the projection information from an existing GeoTIFF file.</span>

<span class="sd">    Args:</span>
<span class="sd">        array (np.ndarray): The NumPy array to be saved as a GeoTIFF.</span>
<span class="sd">        output (str): The path to the output image.</span>
<span class="sd">        source (str, optional): The path to an existing GeoTIFF file with map projection information. Defaults to None.</span>
<span class="sd">        dtype (np.dtype, optional): The data type of the output array. Defaults to None.</span>
<span class="sd">        compress (str, optional): The compression method. Can be one of the following: &quot;deflate&quot;, &quot;lzw&quot;, &quot;packbits&quot;, &quot;jpeg&quot;. Defaults to &quot;deflate&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>
            <span class="k">if</span> <span class="n">compress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compress</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">compression</span>

        <span class="c1"># Determine the minimum and maximum values in the array</span>

        <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Determine the best dtype for the array</span>
            <span class="k">if</span> <span class="n">min_value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
            <span class="k">elif</span> <span class="n">min_value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
            <span class="k">elif</span> <span class="n">min_value</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">128</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>
            <span class="k">elif</span> <span class="n">min_value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span>
            <span class="k">elif</span> <span class="n">min_value</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">32768</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>

        <span class="c1"># Convert the array to the best dtype</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># Define the GeoTIFF metadata</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="n">crs</span><span class="p">,</span>
                <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;dtype&quot;</span><span class="p">:</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="n">crs</span><span class="p">,</span>
                <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">compress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;compress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Array must be 2D or 3D.&quot;</span><span class="p">)</span>

        <span class="c1"># Create a new GeoTIFF file and write the array to it</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.bbox_to_xy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">bbox_to_xy</span><span class="p">(</span><span class="n">src_fp</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">coord_crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.bbox_to_xy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a list of coordinates to pixel coordinates, i.e., (col, row) coordinates.
    Note that map bbox coords is [minx, miny, maxx, maxy] from bottomleft to topright
    While rasterio bbox coords is [minx, max, maxx, min] from topleft to bottomright</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_fp</code></td>
        <td><code>str</code></td>
        <td><p>The source raster file path.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coords</code></td>
        <td><code>list</code></td>
        <td><p>A list of coordinates in the format of [[minx, miny, maxx, maxy], [minx, miny, maxx, maxy], ...]</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coord_crs</code></td>
        <td><code>str</code></td>
        <td><p>The coordinate CRS of the input coordinates. Defaults to "epsg:4326".</p></td>
        <td><code>&#39;epsg:4326&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>A list of pixel coordinates in the format of [[minx, maxy, maxx, miny], ...] from top left to bottom right.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">bbox_to_xy</span><span class="p">(</span>
    <span class="n">src_fp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a list of coordinates to pixel coordinates, i.e., (col, row) coordinates.</span>
<span class="sd">        Note that map bbox coords is [minx, miny, maxx, maxy] from bottomleft to topright</span>
<span class="sd">        While rasterio bbox coords is [minx, max, maxx, min] from topleft to bottomright</span>

<span class="sd">    Args:</span>
<span class="sd">        src_fp (str): The source raster file path.</span>
<span class="sd">        coords (list): A list of coordinates in the format of [[minx, miny, maxx, maxy], [minx, miny, maxx, maxy], ...]</span>
<span class="sd">        coord_crs (str, optional): The coordinate CRS of the input coordinates. Defaults to &quot;epsg:4326&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of pixel coordinates in the format of [[minx, maxy, maxx, miny], ...] from top left to bottom right.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coord_crs</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epsg:</span><span class="si">{</span><span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">json</span>

        <span class="n">geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geojson</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coords must be a list of coordinates.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">]</span>

    <span class="n">new_coords</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">src_fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span>

        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
            <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">coord</span>

            <span class="k">if</span> <span class="n">coord_crs</span> <span class="o">!=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
                <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span> <span class="o">=</span> <span class="n">transform_coords</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">transform_coords</span><span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="n">rows1</span><span class="p">,</span> <span class="n">cols1</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rowcol</span><span class="p">(</span>
                    <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
                <span class="n">rows2</span><span class="p">,</span> <span class="n">cols2</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rowcol</span><span class="p">(</span>
                    <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

                <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cols1</span><span class="p">,</span> <span class="n">rows1</span><span class="p">,</span> <span class="n">cols2</span><span class="p">,</span> <span class="n">rows2</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">new_coords</span><span class="p">:</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">coord</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">minx</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">miny</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">maxx</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">maxy</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">minx</span> <span class="o">&lt;</span> <span class="n">width</span>
            <span class="ow">and</span> <span class="n">miny</span> <span class="o">&lt;</span> <span class="n">height</span>
            <span class="ow">and</span> <span class="n">maxx</span> <span class="o">&lt;</span> <span class="n">width</span>
            <span class="ow">and</span> <span class="n">maxy</span> <span class="o">&lt;</span> <span class="n">height</span>
        <span class="p">):</span>
            <span class="c1"># Note that map bbox coords is [minx, miny, maxx, maxy] from bottomleft to topright</span>
            <span class="c1"># While rasterio bbox coords is [minx, max, maxx, min] from topleft to bottomright</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid pixel coordinates found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some coordinates are out of the image boundary.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.blend_images" class="doc doc-heading">
<code class="highlight language-python"><span class="n">blend_images</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.blend_images" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Blends two images together using the addWeighted function from the OpenCV library.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>img1</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>The first input image on top represented as a NumPy array.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>img2</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>The second input image at the bottom represented as a NumPy array.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>alpha</code></td>
        <td><code>float</code></td>
        <td><p>The weighting factor for the first image in the blend. By default, this is set to 0.5.</p></td>
        <td><code>0.5</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the output image. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>show</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to display the blended image. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>figsize</code></td>
        <td><code>tuple</code></td>
        <td><p>The size of the figure. Defaults to (12, 10).</p></td>
        <td><code>(12, 10)</code></td>
      </tr>
      <tr>
        <td><code>axis</code></td>
        <td><code>str</code></td>
        <td><p>The axis of the figure. Defaults to "off".</p></td>
        <td><code>&#39;off&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to the cv2.addWeighted() function.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>numpy.ndarray</code></td>
      <td><p>The blended image as a NumPy array.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">blend_images</span><span class="p">(</span>
    <span class="n">img1</span><span class="p">,</span>
    <span class="n">img2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;off&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Blends two images together using the addWeighted function from the OpenCV library.</span>

<span class="sd">    Args:</span>
<span class="sd">        img1 (numpy.ndarray): The first input image on top represented as a NumPy array.</span>
<span class="sd">        img2 (numpy.ndarray): The second input image at the bottom represented as a NumPy array.</span>
<span class="sd">        alpha (float): The weighting factor for the first image in the blend. By default, this is set to 0.5.</span>
<span class="sd">        output (str, optional): The path to the output image. Defaults to False.</span>
<span class="sd">        show (bool, optional): Whether to display the blended image. Defaults to True.</span>
<span class="sd">        figsize (tuple, optional): The size of the figure. Defaults to (12, 10).</span>
<span class="sd">        axis (str, optional): The axis of the figure. Defaults to &quot;off&quot;.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to the cv2.addWeighted() function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: The blended image as a NumPy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Resize the images to have the same dimensions</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">img1</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">img1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path </span><span class="si">{</span><span class="n">img1</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

        <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">img2</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">img2</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">img2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">img2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path </span><span class="si">{</span><span class="n">img2</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

        <span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="n">img1</span> <span class="o">=</span> <span class="p">(</span><span class="n">img1</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">img2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="n">img2</span> <span class="o">=</span> <span class="p">(</span><span class="n">img2</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">img1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">img2</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
        <span class="n">img2</span> <span class="o">=</span> <span class="n">img2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">img1</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="p">(</span><span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># Blend the images using the addWeighted function</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>
    <span class="n">blend_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">array_to_image</span><span class="p">(</span><span class="n">blend_img</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">img2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blend_img</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blend_img</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.boxes_to_vector" class="doc doc-heading">
<code class="highlight language-python"><span class="n">boxes_to_vector</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.boxes_to_vector" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert a list of bounding box coordinates to vector data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>coords</code></td>
        <td><code>list</code></td>
        <td><p>A list of bounding box coordinates in the format [[left, top, right, bottom], [left, top, right, bottom], ...].</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src_crs</code></td>
        <td><code>int or str</code></td>
        <td><p>The EPSG code or proj4 string representing the source coordinate reference system (CRS) of the input coordinates.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst_crs</code></td>
        <td><code>int or str</code></td>
        <td><p>The EPSG code or proj4 string representing the destination CRS to reproject the data (default is "EPSG:4326").</p></td>
        <td><code>&#39;EPSG:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str or None</code></td>
        <td><p>The full file path (including the directory and filename without the extension) where the vector data should be saved.
                           If None (default), the function returns the GeoDataFrame without saving it to a file.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to geopandas.GeoDataFrame.to_file() when saving the vector data.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>geopandas.GeoDataFrame or None</code></td>
      <td><p>The GeoDataFrame with the converted vector data if output is None, otherwise None if the data is saved to a file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">boxes_to_vector</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a list of bounding box coordinates to vector data.</span>

<span class="sd">    Args:</span>
<span class="sd">        coords (list): A list of bounding box coordinates in the format [[left, top, right, bottom], [left, top, right, bottom], ...].</span>
<span class="sd">        src_crs (int or str): The EPSG code or proj4 string representing the source coordinate reference system (CRS) of the input coordinates.</span>
<span class="sd">        dst_crs (int or str, optional): The EPSG code or proj4 string representing the destination CRS to reproject the data (default is &quot;EPSG:4326&quot;).</span>
<span class="sd">        output (str or None, optional): The full file path (including the directory and filename without the extension) where the vector data should be saved.</span>
<span class="sd">                                       If None (default), the function returns the GeoDataFrame without saving it to a file.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to geopandas.GeoDataFrame.to_file() when saving the vector data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        geopandas.GeoDataFrame or None: The GeoDataFrame with the converted vector data if output is None, otherwise None if the data is saved to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>

    <span class="c1"># Create a list of Shapely Polygon objects based on the provided coordinates</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>

    <span class="c1"># Create a GeoDataFrame with the Shapely Polygon objects</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">polygons</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="n">src_crs</span><span class="p">)</span>

    <span class="c1"># Reproject the GeoDataFrame to the specified EPSG code</span>
    <span class="n">gdf_reprojected</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdf_reprojected</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdf_reprojected</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.check_file_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">check_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">make_dirs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#samgeo.common.check_file_path" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Gets the absolute file path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_path</code></td>
        <td><code>str</code></td>
        <td><p>The path to the file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>make_dirs</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to create the directory if it does not exist. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>FileNotFoundError</code></td>
        <td><p>If the directory could not be found.</p></td>
      </tr>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>If the input directory path is not a string.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The absolute path to the file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">make_dirs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the absolute file path.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): The path to the file.</span>
<span class="sd">        make_dirs (bool, optional): Whether to create the directory if it does not exist. Defaults to True.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the directory could not be found.</span>
<span class="sd">        TypeError: If the input directory path is not a string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The absolute path to the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">):</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">make_dirs</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">file_path</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided file path must be a string.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.coords_to_geojson" class="doc doc-heading">
<code class="highlight language-python"><span class="n">coords_to_geojson</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#samgeo.common.coords_to_geojson" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert a list of coordinates (lon, lat) to a GeoJSON string or file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>coords</code></td>
        <td><code>list</code></td>
        <td><p>A list of coordinates (lon, lat).</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output file path. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>A GeoJSON dictionary.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">coords_to_geojson</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a list of coordinates (lon, lat) to a GeoJSON string or file.</span>

<span class="sd">    Args:</span>
<span class="sd">        coords (list): A list of coordinates (lon, lat).</span>
<span class="sd">        output (str, optional): The output file path. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A GeoJSON dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">json</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># Create a GeoJSON FeatureCollection object</span>
    <span class="n">feature_collection</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Iterate through the coordinates list and create a GeoJSON Feature object for each coordinate</span>
    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="n">coord</span><span class="p">},</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="n">feature_collection</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

    <span class="c1"># Convert the FeatureCollection object to a JSON string</span>
    <span class="n">geojson_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">feature_collection</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">geojson_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">geojson_str</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.coords_to_xy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">coords_to_xy</span><span class="p">(</span><span class="n">src_fp</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">coord_crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="n">return_out_of_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.coords_to_xy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a list of coordinates to pixel coordinates, i.e., (col, row) coordinates.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_fp</code></td>
        <td><code>str</code></td>
        <td><p>The source raster file path.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coords</code></td>
        <td><code>list</code></td>
        <td><p>A list of coordinates in the format of [[x1, y1], [x2, y2], ...]</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coord_crs</code></td>
        <td><code>str</code></td>
        <td><p>The coordinate CRS of the input coordinates. Defaults to "epsg:4326".</p></td>
        <td><code>&#39;epsg:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>return_out_of_bounds</code></td>
        <td></td>
        <td><p>Whether to return out of bounds coordinates. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to rasterio.transform.rowcol.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>A list of pixel coordinates in the format of [[x1, y1], [x2, y2], ...]</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">coords_to_xy</span><span class="p">(</span>
    <span class="n">src_fp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">coord_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span>
    <span class="n">return_out_of_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a list of coordinates to pixel coordinates, i.e., (col, row) coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        src_fp: The source raster file path.</span>
<span class="sd">        coords: A list of coordinates in the format of [[x1, y1], [x2, y2], ...]</span>
<span class="sd">        coord_crs: The coordinate CRS of the input coordinates. Defaults to &quot;epsg:4326&quot;.</span>
<span class="sd">        return_out_of_bounds: Whether to return out of bounds coordinates. Defaults to False.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to rasterio.transform.rowcol.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of pixel coordinates in the format of [[x1, y1], [x2, y2], ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out_of_bounds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">src_fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span>
        <span class="k">if</span> <span class="n">coord_crs</span> <span class="o">!=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
            <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">transform_coords</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rowcol</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">)]</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_of_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># output = [</span>
    <span class="c1">#     [x, y] for x, y in result if x &gt;= 0 and y &gt;= 0 and x &lt; width and y &lt; height</span>
    <span class="c1"># ]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid pixel coordinates found.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some coordinates are out of the image boundary.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_out_of_bounds</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">out_of_bounds</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.download_checkpoint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_checkpoint</span><span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;vit_h&#39;</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#samgeo.common.download_checkpoint" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download the SAM model checkpoint.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model_type</code></td>
        <td><code>str</code></td>
        <td><p>The model type. Can be one of ['vit_h', 'vit_l', 'vit_b'].
Defaults to 'vit_h'. See https://bit.ly/3VrpxUh for more details.</p></td>
        <td><code>&#39;vit_h&#39;</code></td>
      </tr>
      <tr>
        <td><code>checkpoint_dir</code></td>
        <td><code>str</code></td>
        <td><p>The checkpoint_dir directory. Defaults to None, "~/.cache/torch/hub/checkpoints".</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>hq</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use HQ-SAM model (https://github.com/SysCV/sam-hq). Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_checkpoint</span><span class="p">(</span><span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;vit_h&quot;</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hq</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download the SAM model checkpoint.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_type (str, optional): The model type. Can be one of [&#39;vit_h&#39;, &#39;vit_l&#39;, &#39;vit_b&#39;].</span>
<span class="sd">            Defaults to &#39;vit_h&#39;. See https://bit.ly/3VrpxUh for more details.</span>
<span class="sd">        checkpoint_dir (str, optional): The checkpoint_dir directory. Defaults to None, &quot;~/.cache/torch/hub/checkpoints&quot;.</span>
<span class="sd">        hq (bool, optional): Whether to use HQ-SAM model (https://github.com/SysCV/sam-hq). Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">hq</span><span class="p">:</span>
        <span class="n">model_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vit_h&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_vit_h_4b8939.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;vit_l&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_vit_l_0b3195.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_l_0b3195.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;vit_b&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_vit_b_01ec64.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vit_h&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_hq_vit_h.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;https://github.com/opengeos/datasets/releases/download/models/sam_hq_vit_h.zip&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;https://github.com/opengeos/datasets/releases/download/models/sam_hq_vit_h.z01&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;vit_l&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_hq_vit_l.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/opengeos/datasets/releases/download/models/sam_hq_vit_l.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;vit_b&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_hq_vit_b.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/opengeos/datasets/releases/download/models/sam_hq_vit_b.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;vit_tiny&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sam_hq_vit_tiny.pth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/opengeos/datasets/releases/download/models/sam_hq_vit_tiny.pth&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">model_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_types</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid model_type: </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">. It must be one of </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">checkpoint_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;TORCH_HOME&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/.cache/torch/hub/checkpoints&quot;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span> <span class="n">model_types</span><span class="p">[</span><span class="n">model_type</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model checkpoint for </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">model_types</span><span class="p">[</span><span class="n">model_type</span><span class="p">][</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">download_files</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">,</span> <span class="n">multi_part</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">checkpoint</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.download_checkpoint_legacy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_checkpoint_legacy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.download_checkpoint_legacy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download a checkpoint from URL. It can be one of the following: sam_vit_h_4b8939.pth, sam_vit_l_0b3195.pth, sam_vit_b_01ec64.pth.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>The checkpoint URL. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output file path. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Overwrite the file if it already exists. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The output file path.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_checkpoint_legacy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a checkpoint from URL. It can be one of the following: sam_vit_h_4b8939.pth, sam_vit_l_0b3195.pth, sam_vit_b_01ec64.pth.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): The checkpoint URL. Defaults to None.</span>
<span class="sd">        output (str, optional): The output file path. Defaults to None.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the file if it already exists. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The output file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checkpoints</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;sam_vit_h_4b8939.pth&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sam_vit_l_0b3195.pth&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_l_0b3195.pth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sam_vit_b_01ec64.pth&quot;</span><span class="p">:</span> <span class="s2">&quot;https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">checkpoints</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">checkpoints</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">checkpoints</span><span class="p">[</span><span class="s2">&quot;sam_vit_h_4b8939.pth&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.download_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_cookies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#samgeo.common.download_file" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download a file from URL, including Google Drive shared URL.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>Google Drive URL is also supported. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>Output filename. Default is basename of URL.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>quiet</code></td>
        <td><code>bool</code></td>
        <td><p>Suppress terminal output. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>proxy</code></td>
        <td><code>str</code></td>
        <td><p>Proxy. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>speed</code></td>
        <td><code>float</code></td>
        <td><p>Download byte size per second (e.g., 256KB/s = 256 * 1024). Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_cookies</code></td>
        <td><code>bool</code></td>
        <td><p>Flag to use cookies. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>verify</code></td>
        <td><code>bool | str</code></td>
        <td><p>Either a bool, in which case it controls whether the server's TLS certificate is verified, or a string,
in which case it must be a path to a CA bundle to use. Default is True.. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>id</code></td>
        <td><code>str</code></td>
        <td><p>Google Drive's file ID. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fuzzy</code></td>
        <td><code>bool</code></td>
        <td><p>Fuzzy extraction of Google Drive's file Id. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>resume</code></td>
        <td><code>bool</code></td>
        <td><p>Resume the download from existing tmp file if possible. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>unzip</code></td>
        <td><code>bool</code></td>
        <td><p>Unzip the file. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Overwrite the file if it already exists. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>subfolder</code></td>
        <td><code>bool</code></td>
        <td><p>Create a subfolder with the same name as the file. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The output file path.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_cookies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fuzzy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">subfolder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download a file from URL, including Google Drive shared URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str, optional): Google Drive URL is also supported. Defaults to None.</span>
<span class="sd">        output (str, optional): Output filename. Default is basename of URL.</span>
<span class="sd">        quiet (bool, optional): Suppress terminal output. Default is False.</span>
<span class="sd">        proxy (str, optional): Proxy. Defaults to None.</span>
<span class="sd">        speed (float, optional): Download byte size per second (e.g., 256KB/s = 256 * 1024). Defaults to None.</span>
<span class="sd">        use_cookies (bool, optional): Flag to use cookies. Defaults to True.</span>
<span class="sd">        verify (bool | str, optional): Either a bool, in which case it controls whether the server&#39;s TLS certificate is verified, or a string,</span>
<span class="sd">            in which case it must be a path to a CA bundle to use. Default is True.. Defaults to True.</span>
<span class="sd">        id (str, optional): Google Drive&#39;s file ID. Defaults to None.</span>
<span class="sd">        fuzzy (bool, optional): Fuzzy extraction of Google Drive&#39;s file Id. Defaults to False.</span>
<span class="sd">        resume (bool, optional): Resume the download from existing tmp file if possible. Defaults to False.</span>
<span class="sd">        unzip (bool, optional): Unzip the file. Defaults to True.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the file if it already exists. Defaults to False.</span>
<span class="sd">        subfolder (bool, optional): Create a subfolder with the same name as the file. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The output file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">zipfile</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">gdown</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;The gdown package is required for this function. Use `pip install gdown` to install it.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">output</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overwrite</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2"> already exists. Skip downloading. Set overwrite=True to overwrite.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">github_raw_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;https://drive.google.com/file/d/&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">fuzzy</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">gdown</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">quiet</span><span class="p">,</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">use_cookies</span><span class="p">,</span> <span class="n">verify</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">fuzzy</span><span class="p">,</span> <span class="n">resume</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">unzip</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracting files...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subfolder</span><span class="p">:</span>
                <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.download_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">download_files</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_cookies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fuzzy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">multi_part</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#samgeo.common.download_files" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download files from URLs, including Google Drive shared URL.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>urls</code></td>
        <td><code>list</code></td>
        <td><p>The list of urls to download. Google Drive URL is also supported.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>str</code></td>
        <td><p>The output directory. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>filenames</code></td>
        <td><code>list</code></td>
        <td><p>Output filename. Default is basename of URL.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>quiet</code></td>
        <td><code>bool</code></td>
        <td><p>Suppress terminal output. Default is False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>proxy</code></td>
        <td><code>str</code></td>
        <td><p>Proxy. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>speed</code></td>
        <td><code>float</code></td>
        <td><p>Download byte size per second (e.g., 256KB/s = 256 * 1024). Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>use_cookies</code></td>
        <td><code>bool</code></td>
        <td><p>Flag to use cookies. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>verify</code></td>
        <td><code>bool | str</code></td>
        <td><p>Either a bool, in which case it controls whether the server's TLS certificate is verified, or a string, in which case it must be a path to a CA bundle to use. Default is True.. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>id</code></td>
        <td><code>str</code></td>
        <td><p>Google Drive's file ID. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>fuzzy</code></td>
        <td><code>bool</code></td>
        <td><p>Fuzzy extraction of Google Drive's file Id. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>resume</code></td>
        <td><code>bool</code></td>
        <td><p>Resume the download from existing tmp file if possible. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>unzip</code></td>
        <td><code>bool</code></td>
        <td><p>Unzip the file. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Overwrite the file if it already exists. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>subfolder</code></td>
        <td><code>bool</code></td>
        <td><p>Create a subfolder with the same name as the file. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>multi_part</code></td>
        <td><code>bool</code></td>
        <td><p>If the file is a multi-part file. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>files = ["sam_hq_vit_tiny.zip", "sam_hq_vit_tiny.z01", "sam_hq_vit_tiny.z02", "sam_hq_vit_tiny.z03"]
base_url = "https://github.com/opengeos/datasets/releases/download/models/"
urls = [base_url + f for f in files]
leafmap.download_files(urls, out_dir="models", multi_part=True)</p>

        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">download_files</span><span class="p">(</span>
    <span class="n">urls</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_cookies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fuzzy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">subfolder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">multi_part</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download files from URLs, including Google Drive shared URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        urls (list): The list of urls to download. Google Drive URL is also supported.</span>
<span class="sd">        out_dir (str, optional): The output directory. Defaults to None.</span>
<span class="sd">        filenames (list, optional): Output filename. Default is basename of URL.</span>
<span class="sd">        quiet (bool, optional): Suppress terminal output. Default is False.</span>
<span class="sd">        proxy (str, optional): Proxy. Defaults to None.</span>
<span class="sd">        speed (float, optional): Download byte size per second (e.g., 256KB/s = 256 * 1024). Defaults to None.</span>
<span class="sd">        use_cookies (bool, optional): Flag to use cookies. Defaults to True.</span>
<span class="sd">        verify (bool | str, optional): Either a bool, in which case it controls whether the server&#39;s TLS certificate is verified, or a string, in which case it must be a path to a CA bundle to use. Default is True.. Defaults to True.</span>
<span class="sd">        id (str, optional): Google Drive&#39;s file ID. Defaults to None.</span>
<span class="sd">        fuzzy (bool, optional): Fuzzy extraction of Google Drive&#39;s file Id. Defaults to False.</span>
<span class="sd">        resume (bool, optional): Resume the download from existing tmp file if possible. Defaults to False.</span>
<span class="sd">        unzip (bool, optional): Unzip the file. Defaults to True.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the file if it already exists. Defaults to False.</span>
<span class="sd">        subfolder (bool, optional): Create a subfolder with the same name as the file. Defaults to False.</span>
<span class="sd">        multi_part (bool, optional): If the file is a multi-part file. Defaults to False.</span>

<span class="sd">    Examples:</span>

<span class="sd">        files = [&quot;sam_hq_vit_tiny.zip&quot;, &quot;sam_hq_vit_tiny.z01&quot;, &quot;sam_hq_vit_tiny.z02&quot;, &quot;sam_hq_vit_tiny.z03&quot;]</span>
<span class="sd">        base_url = &quot;https://github.com/opengeos/datasets/releases/download/models/&quot;</span>
<span class="sd">        urls = [base_url + f for f in files]</span>
<span class="sd">        leafmap.download_files(urls, out_dir=&quot;models&quot;, multi_part=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">filepaths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">filenames</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

        <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multi_part</span><span class="p">:</span>
            <span class="n">unzip</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">download_file</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">quiet</span><span class="p">,</span>
            <span class="n">proxy</span><span class="p">,</span>
            <span class="n">speed</span><span class="p">,</span>
            <span class="n">use_cookies</span><span class="p">,</span>
            <span class="n">verify</span><span class="p">,</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">fuzzy</span><span class="p">,</span>
            <span class="n">resume</span><span class="p">,</span>
            <span class="n">unzip</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="p">,</span>
            <span class="n">subfolder</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">multi_part</span><span class="p">:</span>
        <span class="n">archive</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">extract_archive</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.extract_archive" class="doc doc-heading">
<code class="highlight language-python"><span class="n">extract_archive</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.extract_archive" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Extracts a multipart archive.</p>
<p>This function uses the patoolib library to extract a multipart archive.
If the patoolib library is not installed, it attempts to install it.
If the archive does not end with ".zip", it appends ".zip" to the archive name.
If the extraction fails (for example, if the files already exist), it skips the extraction.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>archive</code></td>
        <td><code>str</code></td>
        <td><p>The path to the archive file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>outdir</code></td>
        <td><code>str</code></td>
        <td><p>The directory where the archive should be extracted.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Arbitrary keyword arguments for the patoolib.extract_archive function.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>None</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>Exception</code></td>
        <td><p>An exception is raised if the extraction fails for reasons other than the files already existing.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Examples:</strong></p>
    <p>files = ["sam_hq_vit_tiny.zip", "sam_hq_vit_tiny.z01", "sam_hq_vit_tiny.z02", "sam_hq_vit_tiny.z03"]
base_url = "https://github.com/opengeos/datasets/releases/download/models/"
urls = [base_url + f for f in files]
leafmap.download_files(urls, out_dir="models", multi_part=True)</p>

        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">extract_archive</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts a multipart archive.</span>

<span class="sd">    This function uses the patoolib library to extract a multipart archive.</span>
<span class="sd">    If the patoolib library is not installed, it attempts to install it.</span>
<span class="sd">    If the archive does not end with &quot;.zip&quot;, it appends &quot;.zip&quot; to the archive name.</span>
<span class="sd">    If the extraction fails (for example, if the files already exist), it skips the extraction.</span>

<span class="sd">    Args:</span>
<span class="sd">        archive (str): The path to the archive file.</span>
<span class="sd">        outdir (str): The directory where the archive should be extracted.</span>
<span class="sd">        **kwargs: Arbitrary keyword arguments for the patoolib.extract_archive function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: An exception is raised if the extraction fails for reasons other than the files already existing.</span>

<span class="sd">    Example:</span>

<span class="sd">        files = [&quot;sam_hq_vit_tiny.zip&quot;, &quot;sam_hq_vit_tiny.z01&quot;, &quot;sam_hq_vit_tiny.z02&quot;, &quot;sam_hq_vit_tiny.z03&quot;]</span>
<span class="sd">        base_url = &quot;https://github.com/opengeos/datasets/releases/download/models/&quot;</span>
<span class="sd">        urls = [base_url + f for f in files]</span>
<span class="sd">        leafmap.download_files(urls, out_dir=&quot;models&quot;, multi_part=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">patoolib</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">install_package</span><span class="p">(</span><span class="s2">&quot;patool&quot;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">patoolib</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">archive</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
        <span class="n">archive</span> <span class="o">=</span> <span class="n">archive</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span>

    <span class="k">if</span> <span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">archive</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">patoolib</span><span class="o">.</span><span class="n">extract_archive</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The unzipped files might already exist. Skipping extraction.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.geojson_to_coords" class="doc doc-heading">
<code class="highlight language-python"><span class="n">geojson_to_coords</span><span class="p">(</span><span class="n">geojson</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span></code>


<a href="#samgeo.common.geojson_to_coords" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a geojson file or a dictionary of feature collection to a list of centroid coordinates.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>geojson</code></td>
        <td><code>str | dict</code></td>
        <td><p>The geojson file path or a dictionary of feature collection.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src_crs</code></td>
        <td><code>str</code></td>
        <td><p>The source CRS. Defaults to "epsg:4326".</p></td>
        <td><code>&#39;epsg:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>dst_crs</code></td>
        <td><code>str</code></td>
        <td><p>The destination CRS. Defaults to "epsg:4326".</p></td>
        <td><code>&#39;epsg:4326&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>A list of centroid coordinates in the format of [[x1, y1], [x2, y2], ...]</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">geojson_to_coords</span><span class="p">(</span>
    <span class="n">geojson</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:4326&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a geojson file or a dictionary of feature collection to a list of centroid coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        geojson (str | dict): The geojson file path or a dictionary of feature collection.</span>
<span class="sd">        src_crs (str, optional): The source CRS. Defaults to &quot;epsg:4326&quot;.</span>
<span class="sd">        dst_crs (str, optional): The destination CRS. Defaults to &quot;epsg:4326&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of centroid coordinates in the format of [[x1, y1], [x2, y2], ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">import</span> <span class="nn">warnings</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geojson</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">geojson</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geojson</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
    <span class="n">centroids</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">centroid</span>
    <span class="n">centroid_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">centroids</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">src_crs</span> <span class="o">!=</span> <span class="n">dst_crs</span><span class="p">:</span>
        <span class="n">centroid_list</span> <span class="o">=</span> <span class="n">transform_coords</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">centroid_list</span><span class="p">],</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">centroid_list</span><span class="p">],</span>
            <span class="n">src_crs</span><span class="p">,</span>
            <span class="n">dst_crs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">centroid_list</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">centroid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">centroid_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">centroid_list</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.geojson_to_xy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">geojson_to_xy</span><span class="p">(</span><span class="n">src_fp</span><span class="p">,</span> <span class="n">geojson</span><span class="p">,</span> <span class="n">coord_crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.geojson_to_xy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a geojson file or a dictionary of feature collection to a list of pixel coordinates.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_fp</code></td>
        <td><code>str</code></td>
        <td><p>The source raster file path.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>geojson</code></td>
        <td><code>str</code></td>
        <td><p>The geojson file path or a dictionary of feature collection.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coord_crs</code></td>
        <td><code>str</code></td>
        <td><p>The coordinate CRS of the input coordinates. Defaults to "epsg:4326".</p></td>
        <td><code>&#39;epsg:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to rasterio.transform.rowcol.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>list</code></td>
      <td><p>A list of pixel coordinates in the format of [[x1, y1], [x2, y2], ...]</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">geojson_to_xy</span><span class="p">(</span>
    <span class="n">src_fp</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">geojson</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epsg:4326&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a geojson file or a dictionary of feature collection to a list of pixel coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        src_fp: The source raster file path.</span>
<span class="sd">        geojson: The geojson file path or a dictionary of feature collection.</span>
<span class="sd">        coord_crs: The coordinate CRS of the input coordinates. Defaults to &quot;epsg:4326&quot;.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to rasterio.transform.rowcol.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of pixel coordinates in the format of [[x1, y1], [x2, y2], ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">src_fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">geojson_to_coords</span><span class="p">(</span><span class="n">geojson</span><span class="p">,</span> <span class="n">coord_crs</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coords_to_xy</span><span class="p">(</span><span class="n">src_fp</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.get_basemaps" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_basemaps</span><span class="p">(</span><span class="n">free_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#samgeo.common.get_basemaps" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Returns a dictionary of xyz basemaps.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>free_only</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to return only free xyz tile services that do not require an access token. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>A dictionary of xyz basemaps.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_basemaps</span><span class="p">(</span><span class="n">free_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary of xyz basemaps.</span>

<span class="sd">    Args:</span>
<span class="sd">        free_only (bool, optional): Whether to return only free xyz tile services that do not require an access token. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of xyz basemaps.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">basemaps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">xyz_dict</span> <span class="o">=</span> <span class="n">get_xyz_dict</span><span class="p">(</span><span class="n">free_only</span><span class="o">=</span><span class="n">free_only</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xyz_dict</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">xyz_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">xyz_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">build_url</span><span class="p">()</span>
        <span class="n">basemaps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">return</span> <span class="n">basemaps</span>
</code></pre></div>
        </details>
    </div>

  </div>







  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.get_vector_crs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_vector_crs</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.get_vector_crs" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Gets the CRS of a vector file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filename</code></td>
        <td><code>str</code></td>
        <td><p>The vector file path.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The CRS of the vector file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_vector_crs</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the CRS of a vector file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The vector file path.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The CRS of the vector file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">epsg</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">epsg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;EPSG:</span><span class="si">{</span><span class="n">epsg</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.get_xyz_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_xyz_dict</span><span class="p">(</span><span class="n">free_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#samgeo.common.get_xyz_dict" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Returns a dictionary of xyz services.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>free_only</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to return only free xyz tile services that do not require an access token. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>A dictionary of xyz services.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_xyz_dict</span><span class="p">(</span><span class="n">free_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary of xyz services.</span>

<span class="sd">    Args:</span>
<span class="sd">        free_only (bool, optional): Whether to return only free xyz tile services that do not require an access token. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary of xyz services.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">collections</span>
    <span class="kn">import</span> <span class="nn">xyzservices.providers</span> <span class="k">as</span> <span class="nn">xyz</span>

    <span class="k">def</span> <span class="nf">_unpack_sub_parameters</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">for</span> <span class="n">sub_param</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">sub_param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp</span>

    <span class="n">xyz_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">xyz</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="n">_unpack_sub_parameters</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_unpack_sub_parameters</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">requires_token</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">free_only</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xyz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xyz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_item</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="n">sub_item</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">tile</span> <span class="o">=</span> <span class="n">_unpack_sub_parameters</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_unpack_sub_parameters</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">requires_token</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">free_only</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xyz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xyz_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tile</span>

    <span class="n">xyz_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">xyz_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">xyz_dict</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.github_raw_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">github_raw_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>


<a href="#samgeo.common.github_raw_url" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Get the raw URL for a GitHub file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>The GitHub URL.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The raw URL.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">github_raw_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the raw URL for a GitHub file.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): The GitHub URL.</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: The raw URL.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://github.com/&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;blob&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;github.com&quot;</span><span class="p">,</span> <span class="s2">&quot;raw.githubusercontent.com&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;blob/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">url</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.image_to_cog" class="doc doc-heading">
<code class="highlight language-python"><span class="n">image_to_cog</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dst_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="s1">&#39;deflate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.image_to_cog" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts an image to a COG file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>A dataset path, URL or rasterio.io.DatasetReader object.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst_path</code></td>
        <td><code>str</code></td>
        <td><p>An output dataset path or or PathLike object. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>profile</code></td>
        <td><code>str</code></td>
        <td><p>COG profile. More at https://cogeotiff.github.io/rio-cogeo/profile. Defaults to "deflate".</p></td>
        <td><code>&#39;deflate&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ImportError</code></td>
        <td><p>If rio-cogeo is not installed.</p></td>
      </tr>
      <tr>
        <td><code>FileNotFoundError</code></td>
        <td><p>If the source file could not be found.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">image_to_cog</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dst_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="s2">&quot;deflate&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts an image to a COG file.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str): A dataset path, URL or rasterio.io.DatasetReader object.</span>
<span class="sd">        dst_path (str, optional): An output dataset path or or PathLike object. Defaults to None.</span>
<span class="sd">        profile (str, optional): COG profile. More at https://cogeotiff.github.io/rio-cogeo/profile. Defaults to &quot;deflate&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If rio-cogeo is not installed.</span>
<span class="sd">        FileNotFoundError: If the source file could not be found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">rio_cogeo.cogeo</span> <span class="kn">import</span> <span class="n">cog_translate</span>
        <span class="kn">from</span> <span class="nn">rio_cogeo.profiles</span> <span class="kn">import</span> <span class="n">cog_profiles</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The rio-cogeo package is not installed. Please install it with `pip install rio-cogeo` or `conda install rio-cogeo -c conda-forge`.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">check_file_path</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;The provided input file could not be found.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dst_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">source</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_cog.tif&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">temp_file_path</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span>

    <span class="n">dst_path</span> <span class="o">=</span> <span class="n">check_file_path</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>

    <span class="n">dst_profile</span> <span class="o">=</span> <span class="n">cog_profiles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
    <span class="n">cog_translate</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">,</span> <span class="n">dst_profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.install_package" class="doc doc-heading">
<code class="highlight language-python"><span class="n">install_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span></code>


<a href="#samgeo.common.install_package" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Install a Python package.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>package</code></td>
        <td><code>str | list</code></td>
        <td><p>The package name or a GitHub URL or a list of package names or GitHub URLs.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">install_package</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Install a Python package.</span>

<span class="sd">    Args:</span>
<span class="sd">        package (str | list): The package name or a GitHub URL or a list of package names or GitHub URLs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">package</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://github.com&quot;</span><span class="p">):</span>
            <span class="n">package</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;git+</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Execute pip install command and show output in real-time</span>
        <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pip install </span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

        <span class="c1"># Print output in real-time</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">process</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># Wait for process to complete</span>
        <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.is_colab" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_colab</span><span class="p">()</span></code>


<a href="#samgeo.common.is_colab" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Tests if the code is being executed within Google Colab.</p>

        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_colab</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests if the code is being executed within Google Colab.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.merge_rasters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge_rasters</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">input_pattern</span><span class="o">=</span><span class="s1">&#39;*.tif&#39;</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">output_nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;COMPRESS=DEFLATE&#39;</span><span class="p">])</span></code>


<a href="#samgeo.common.merge_rasters" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Merge a directory of rasters into a single raster.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>input_dir</code></td>
        <td><code>str</code></td>
        <td><p>The path to the input directory.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the output raster.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>input_pattern</code></td>
        <td><code>str</code></td>
        <td><p>The pattern to match the input files. Defaults to "*.tif".</p></td>
        <td><code>&#39;*.tif&#39;</code></td>
      </tr>
      <tr>
        <td><code>output_format</code></td>
        <td><code>str</code></td>
        <td><p>The output format. Defaults to "GTiff".</p></td>
        <td><code>&#39;GTiff&#39;</code></td>
      </tr>
      <tr>
        <td><code>output_nodata</code></td>
        <td><code>float</code></td>
        <td><p>The output nodata value. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>output_options</code></td>
        <td><code>list</code></td>
        <td><p>A list of output options. Defaults to ["COMPRESS=DEFLATE"].</p></td>
        <td><code>[&#39;COMPRESS=DEFLATE&#39;]</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ImportError</code></td>
        <td><p>Raised if GDAL is not installed.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">merge_rasters</span><span class="p">(</span>
    <span class="n">input_dir</span><span class="p">,</span>
    <span class="n">output</span><span class="p">,</span>
    <span class="n">input_pattern</span><span class="o">=</span><span class="s2">&quot;*.tif&quot;</span><span class="p">,</span>
    <span class="n">output_format</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
    <span class="n">output_nodata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COMPRESS=DEFLATE&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge a directory of rasters into a single raster.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_dir (str): The path to the input directory.</span>
<span class="sd">        output (str): The path to the output raster.</span>
<span class="sd">        input_pattern (str, optional): The pattern to match the input files. Defaults to &quot;*.tif&quot;.</span>
<span class="sd">        output_format (str, optional): The output format. Defaults to &quot;GTiff&quot;.</span>
<span class="sd">        output_nodata (float, optional): The output nodata value. Defaults to None.</span>
<span class="sd">        output_options (list, optional): A list of output options. Defaults to [&quot;COMPRESS=DEFLATE&quot;].</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: Raised if GDAL is not installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">glob</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;GDAL is required to use this function. Install it with `conda install gdal -c conda-forge`&quot;</span>
        <span class="p">)</span>
    <span class="c1"># Get a list of all the input files</span>
    <span class="n">input_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">input_pattern</span><span class="p">))</span>

    <span class="c1"># Merge the input files into a single output file</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span>
        <span class="n">output</span><span class="p">,</span>
        <span class="n">input_files</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">output_format</span><span class="p">,</span>
        <span class="n">dstNodata</span><span class="o">=</span><span class="n">output_nodata</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="n">output_options</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.overlay_images" class="doc doc-heading">
<code class="highlight language-python"><span class="n">overlay_images</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">show_args1</span><span class="o">=</span><span class="p">{},</span> <span class="n">show_args2</span><span class="o">=</span><span class="p">{})</span></code>


<a href="#samgeo.common.overlay_images" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Overlays two images using a slider to control the opacity of the top image.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>image1</code></td>
        <td><code>str | np.ndarray</code></td>
        <td><p>The first input image at the bottom represented as a NumPy array or the path to the image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>image2</code></td>
        <td><code>_type_</code></td>
        <td><p>The second input image on top represented as a NumPy array or the path to the image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>alpha</code></td>
        <td><code>float</code></td>
        <td><p>The alpha value of the top image. Defaults to 0.5.</p></td>
        <td><code>0.5</code></td>
      </tr>
      <tr>
        <td><code>backend</code></td>
        <td><code>str</code></td>
        <td><p>The backend of the matplotlib plot. Defaults to "TkAgg".</p></td>
        <td><code>&#39;TkAgg&#39;</code></td>
      </tr>
      <tr>
        <td><code>height_ratios</code></td>
        <td><code>list</code></td>
        <td><p>The height ratios of the two subplots. Defaults to [10, 1].</p></td>
        <td><code>[10, 1]</code></td>
      </tr>
      <tr>
        <td><code>show_args1</code></td>
        <td><code>dict</code></td>
        <td><p>The keyword arguments to pass to the imshow() function for the first image. Defaults to {}.</p></td>
        <td><code>{}</code></td>
      </tr>
      <tr>
        <td><code>show_args2</code></td>
        <td><code>dict</code></td>
        <td><p>The keyword arguments to pass to the imshow() function for the second image. Defaults to {}.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">overlay_images</span><span class="p">(</span>
    <span class="n">image1</span><span class="p">,</span>
    <span class="n">image2</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;TkAgg&quot;</span><span class="p">,</span>
    <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">show_args1</span><span class="o">=</span><span class="p">{},</span>
    <span class="n">show_args2</span><span class="o">=</span><span class="p">{},</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overlays two images using a slider to control the opacity of the top image.</span>

<span class="sd">    Args:</span>
<span class="sd">        image1 (str | np.ndarray): The first input image at the bottom represented as a NumPy array or the path to the image.</span>
<span class="sd">        image2 (_type_): The second input image on top represented as a NumPy array or the path to the image.</span>
<span class="sd">        alpha (float, optional): The alpha value of the top image. Defaults to 0.5.</span>
<span class="sd">        backend (str, optional): The backend of the matplotlib plot. Defaults to &quot;TkAgg&quot;.</span>
<span class="sd">        height_ratios (list, optional): The height ratios of the two subplots. Defaults to [10, 1].</span>
<span class="sd">        show_args1 (dict, optional): The keyword arguments to pass to the imshow() function for the first image. Defaults to {}.</span>
<span class="sd">        show_args2 (dict, optional): The keyword arguments to pass to the imshow() function for the second image. Defaults to {}.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="kn">import</span> <span class="nn">matplotlib.widgets</span> <span class="k">as</span> <span class="nn">mpwidgets</span>

    <span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;inline&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;The TkAgg backend is not supported in Google Colab. The overlay_images function will not work on Colab.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">image1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">image1</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path </span><span class="si">{</span><span class="n">image1</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">image2</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">image2</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">image2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">image2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input path </span><span class="si">{</span><span class="n">image2</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

    <span class="c1"># Load the two images</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image2</span><span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="n">height_ratios</span><span class="p">})</span>
    <span class="n">img0</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">show_args1</span><span class="p">)</span>
    <span class="n">img1</span> <span class="o">=</span> <span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="o">**</span><span class="n">show_args2</span><span class="p">)</span>

    <span class="c1"># Define the update function</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">img1</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="c1"># Create the slider</span>
    <span class="n">slider0</span> <span class="o">=</span> <span class="n">mpwidgets</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">valmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">slider0</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

    <span class="c1"># Display the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.random_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">random_string</span><span class="p">(</span><span class="n">string_length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></code>


<a href="#samgeo.common.random_string" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Generates a random string of fixed length.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>string_length</code></td>
        <td><code>int</code></td>
        <td><p>Fixed length. Defaults to 3.</p></td>
        <td><code>6</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>A random string</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">random_string</span><span class="p">(</span><span class="n">string_length</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a random string of fixed length.</span>

<span class="sd">    Args:</span>
<span class="sd">        string_length (int, optional): Fixed length. Defaults to 3.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A random string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="kn">import</span> <span class="nn">string</span>

    <span class="c1"># random.seed(1001)</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">string_length</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.raster_to_geojson" class="doc doc-heading">
<code class="highlight language-python"><span class="n">raster_to_geojson</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.raster_to_geojson" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert a tiff file to a GeoJSON file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>tiff_path</code></td>
        <td><code>str</code></td>
        <td><p>The path to the tiff file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the GeoJSON file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>simplify_tolerance</code></td>
        <td><code>float</code></td>
        <td><p>The maximum allowed geometry displacement.
The higher this value, the smaller the number of vertices in the resulting geometry.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">raster_to_geojson</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a tiff file to a GeoJSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tiff_path (str): The path to the tiff file.</span>
<span class="sd">        output (str): The path to the GeoJSON file.</span>
<span class="sd">        simplify_tolerance (float, optional): The maximum allowed geometry displacement.</span>
<span class="sd">            The higher this value, the smaller the number of vertices in the resulting geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.geojson&quot;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;.geojson&quot;</span>

    <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="n">simplify_tolerance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.raster_to_gpkg" class="doc doc-heading">
<code class="highlight language-python"><span class="n">raster_to_gpkg</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.raster_to_gpkg" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert a tiff file to a gpkg file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>tiff_path</code></td>
        <td><code>str</code></td>
        <td><p>The path to the tiff file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the gpkg file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>simplify_tolerance</code></td>
        <td><code>float</code></td>
        <td><p>The maximum allowed geometry displacement.
The higher this value, the smaller the number of vertices in the resulting geometry.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">raster_to_gpkg</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a tiff file to a gpkg file.</span>

<span class="sd">    Args:</span>
<span class="sd">        tiff_path (str): The path to the tiff file.</span>
<span class="sd">        output (str): The path to the gpkg file.</span>
<span class="sd">        simplify_tolerance (float, optional): The maximum allowed geometry displacement.</span>
<span class="sd">            The higher this value, the smaller the number of vertices in the resulting geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gpkg&quot;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;.gpkg&quot;</span>

    <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="n">simplify_tolerance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.raster_to_shp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">raster_to_shp</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.raster_to_shp" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Convert a tiff file to a shapefile.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>tiff_path</code></td>
        <td><code>str</code></td>
        <td><p>The path to the tiff file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the shapefile.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>simplify_tolerance</code></td>
        <td><code>float</code></td>
        <td><p>The maximum allowed geometry displacement.
The higher this value, the smaller the number of vertices in the resulting geometry.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">raster_to_shp</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a tiff file to a shapefile.</span>

<span class="sd">    Args:</span>
<span class="sd">        tiff_path (str): The path to the tiff file.</span>
<span class="sd">        output (str): The path to the shapefile.</span>
<span class="sd">        simplify_tolerance (float, optional): The maximum allowed geometry displacement.</span>
<span class="sd">            The higher this value, the smaller the number of vertices in the resulting geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;.shp&quot;</span>

    <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">tiff_path</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="n">simplify_tolerance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.raster_to_vector" class="doc doc-heading">
<code class="highlight language-python"><span class="n">raster_to_vector</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.raster_to_vector" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Vectorize a raster dataset.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>The path to the tiff file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The path to the vector file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>simplify_tolerance</code></td>
        <td><code>float</code></td>
        <td><p>The maximum allowed geometry displacement.
The higher this value, the smaller the number of vertices in the resulting geometry.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">raster_to_vector</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">simplify_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vectorize a raster dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str): The path to the tiff file.</span>
<span class="sd">        output (str): The path to the vector file.</span>
<span class="sd">        simplify_tolerance (float, optional): The maximum allowed geometry displacement.</span>
<span class="sd">            The higher this value, the smaller the number of vertices in the resulting geometry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">features</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">band</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">band</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

    <span class="n">fc</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}}</span>
        <span class="k">for</span> <span class="n">shape</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">shapes</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">simplify_tolerance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fc</span><span class="p">:</span>
            <span class="n">i</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="n">simplify_tolerance</span><span class="p">)</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_features</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dst_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">dst_crs</span><span class="p">)</span>

    <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.regularize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">regularize</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.regularize" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Regularize a polygon GeoDataFrame.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>source</code></td>
        <td><code>str | gpd.GeoDataFrame</code></td>
        <td><p>The input file path or a GeoDataFrame.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output file path. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>gpd.GeoDataFrame</code></td>
      <td><p>The output GeoDataFrame.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">regularize</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Regularize a polygon GeoDataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str | gpd.GeoDataFrame): The input file path or a GeoDataFrame.</span>
<span class="sd">        output (str, optional): The output file path. Defaults to None.</span>


<span class="sd">    Returns:</span>
<span class="sd">        gpd.GeoDataFrame: The output GeoDataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">source</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input source must be a GeoDataFrame or a file path.&quot;</span><span class="p">)</span>

    <span class="n">polygons</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">geom</span><span class="p">:</span> <span class="n">geom</span><span class="o">.</span><span class="n">minimum_rotated_rectangle</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">polygons</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.reproject" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reproject</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">resampling</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">to_cog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.reproject" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Reprojects an image.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>image</code></td>
        <td><code>str</code></td>
        <td><p>The input image filepath.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output image filepath.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst_crs</code></td>
        <td><code>str</code></td>
        <td><p>The destination CRS. Defaults to "EPSG:4326".</p></td>
        <td><code>&#39;EPSG:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>resampling</code></td>
        <td><code>Resampling</code></td>
        <td><p>The resampling method. Defaults to "nearest".</p></td>
        <td><code>&#39;nearest&#39;</code></td>
      </tr>
      <tr>
        <td><code>to_cog</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to convert the output image to a Cloud Optimized GeoTIFF. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to rasterio.open.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reproject</span><span class="p">(</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">resampling</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">to_cog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reprojects an image.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (str): The input image filepath.</span>
<span class="sd">        output (str): The output image filepath.</span>
<span class="sd">        dst_crs (str, optional): The destination CRS. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">        resampling (Resampling, optional): The resampling method. Defaults to &quot;nearest&quot;.</span>
<span class="sd">        to_cog (bool, optional): Whether to convert the output image to a Cloud Optimized GeoTIFF. Defaults to True.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to rasterio.open.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
    <span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">calculate_default_transform</span><span class="p">,</span> <span class="n">reproject</span><span class="p">,</span> <span class="n">Resampling</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resampling</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">resampling</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Resampling</span><span class="p">,</span> <span class="n">resampling</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">transform</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">calculate_default_transform</span><span class="p">(</span>
            <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span><span class="o">.</span><span class="n">bounds</span>
        <span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="n">dst_crs</span><span class="p">,</span>
                <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">reproject</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">rio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">rio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                    <span class="n">src_transform</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                    <span class="n">src_crs</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">dst_transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                    <span class="n">dst_crs</span><span class="o">=</span><span class="n">dst_crs</span><span class="p">,</span>
                    <span class="n">resampling</span><span class="o">=</span><span class="n">resampling</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="n">to_cog</span><span class="p">:</span>
        <span class="n">image_to_cog</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.rowcol_to_xy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rowcol_to_xy</span><span class="p">(</span><span class="n">src_fp</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dst_crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.rowcol_to_xy" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a list of (row, col) coordinates to (x, y) coordinates.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src_fp</code></td>
        <td><code>str</code></td>
        <td><p>The source raster file path.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>rows</code></td>
        <td><code>list</code></td>
        <td><p>A list of row coordinates. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>cols</code></td>
        <td><code>list</code></td>
        <td><p>A list of col coordinates. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>boxes</code></td>
        <td><code>list</code></td>
        <td><p>A list of (row, col) coordinates in the format of [[left, top, right, bottom], [left, top, right, bottom], ...]</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>zs</code></td>
        <td></td>
        <td><p>zs (list or float, optional): Height associated with coordinates. Primarily used for RPC based coordinate transformations.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>offset</code></td>
        <td><code>str</code></td>
        <td><p>Determines if the returned coordinates are for the center of the pixel or for a corner.</p></td>
        <td><code>&#39;center&#39;</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output vector file path. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>dst_crs</code></td>
        <td><code>str</code></td>
        <td><p>The destination CRS. Defaults to "EPSG:4326".</p></td>
        <td><code>&#39;EPSG:4326&#39;</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to rasterio.transform.xy.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>A list of (x, y) coordinates.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rowcol_to_xy</span><span class="p">(</span>
    <span class="n">src_fp</span><span class="p">,</span>
    <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dst_crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a list of (row, col) coordinates to (x, y) coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        src_fp (str): The source raster file path.</span>
<span class="sd">        rows (list, optional): A list of row coordinates. Defaults to None.</span>
<span class="sd">        cols (list, optional): A list of col coordinates. Defaults to None.</span>
<span class="sd">        boxes (list, optional): A list of (row, col) coordinates in the format of [[left, top, right, bottom], [left, top, right, bottom], ...]</span>
<span class="sd">        zs: zs (list or float, optional): Height associated with coordinates. Primarily used for RPC based coordinate transformations.</span>
<span class="sd">        offset (str, optional): Determines if the returned coordinates are for the center of the pixel or for a corner.</span>
<span class="sd">        output (str, optional): The output vector file path. Defaults to None.</span>
<span class="sd">        dst_crs (str, optional): The destination CRS. Defaults to &quot;EPSG:4326&quot;.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to rasterio.transform.xy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of (x, y) coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">boxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;rows and cols must be provided.&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">src_fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">src_crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>

    <span class="k">if</span> <span class="n">boxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boxes_to_vector</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.sam_map_gui" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sam_map_gui</span><span class="p">(</span><span class="n">sam</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;SATELLITE&#39;</span><span class="p">,</span> <span class="n">repeat_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.sam_map_gui" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Display the SAM Map GUI.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>sam</code></td>
        <td><code>SamGeo</code></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>basemap</code></td>
        <td><code>str</code></td>
        <td><p>The basemap to use. Defaults to "SATELLITE".</p></td>
        <td><code>&#39;SATELLITE&#39;</code></td>
      </tr>
      <tr>
        <td><code>repeat_mode</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to use the repeat mode for the draw control. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>str</code></td>
        <td><p>The output directory. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sam_map_gui</span><span class="p">(</span><span class="n">sam</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s2">&quot;SATELLITE&quot;</span><span class="p">,</span> <span class="n">repeat_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the SAM Map GUI.</span>

<span class="sd">    Args:</span>
<span class="sd">        sam (SamGeo):</span>
<span class="sd">        basemap (str, optional): The basemap to use. Defaults to &quot;SATELLITE&quot;.</span>
<span class="sd">        repeat_mode (bool, optional): Whether to use the repeat mode for the draw control. Defaults to True.</span>
<span class="sd">        out_dir (str, optional): The output directory. Defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="kn">import</span> <span class="nn">leafmap</span>
        <span class="kn">import</span> <span class="nn">ipyleaflet</span>
        <span class="kn">import</span> <span class="nn">ipyevents</span>
        <span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
        <span class="kn">from</span> <span class="nn">ipyfilechooser</span> <span class="kn">import</span> <span class="n">FileChooser</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The sam_map function requires the leafmap package. Please install it first.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">leafmap</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">repeat_mode</span><span class="o">=</span><span class="n">repeat_mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">default_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="s2">&quot;crosshair&quot;</span><span class="p">}</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Skip the image layer if localtileserver is not available</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">fg_layer</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">LayerGroup</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Foreground&quot;</span><span class="p">)</span>
    <span class="n">bg_layer</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">LayerGroup</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Background&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fg_layer</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bg_layer</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">fg_layer</span> <span class="o">=</span> <span class="n">fg_layer</span>
    <span class="n">m</span><span class="o">.</span><span class="n">bg_layer</span> <span class="o">=</span> <span class="n">bg_layer</span>

    <span class="n">widget_width</span> <span class="o">=</span> <span class="s2">&quot;280px&quot;</span>
    <span class="n">button_width</span> <span class="o">=</span> <span class="s2">&quot;90px&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;0px 0px 0px 4px&quot;</span>  <span class="c1"># upper, right, bottom, left</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">}</span>

    <span class="n">toolbar_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Toolbar&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;gear&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">close_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Close the tool&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;times&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">plus_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Load foreground points&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;plus-circle&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">minus_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Load background points&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;minus-circle&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">radio_buttons</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Foreground&quot;</span><span class="p">,</span> <span class="s2">&quot;Background&quot;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Class Type:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">fg_count</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Foreground #:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;135px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">bg_count</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntText</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Background #:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;135px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">segment_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Segment&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">save_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span>
    <span class="p">)</span>

    <span class="n">reset_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span>
    <span class="p">)</span>
    <span class="n">segment_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>
    <span class="n">save_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>
    <span class="n">reset_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>

    <span class="n">opacity_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Mask opacity:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">rectangular</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Regularize&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;130px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">colorpicker</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span>
        <span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Color&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#ffff00&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;140px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">buttons</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">radio_buttons</span><span class="p">,</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">fg_count</span><span class="p">,</span> <span class="n">bg_count</span><span class="p">]),</span>
            <span class="n">opacity_slider</span><span class="p">,</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">rectangular</span><span class="p">,</span> <span class="n">colorpicker</span><span class="p">]),</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
                <span class="p">[</span><span class="n">segment_button</span><span class="p">,</span> <span class="n">save_button</span><span class="p">,</span> <span class="n">reset_button</span><span class="p">],</span>
                <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="s2">&quot;0px 4px 0px 4px&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">opacity_changed</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Masks&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask_layer</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">opacity_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">opacity_changed</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">widget_width</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">toolbar_header</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">()</span>
    <span class="n">toolbar_header</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">close_button</span><span class="p">,</span> <span class="n">plus_button</span><span class="p">,</span> <span class="n">minus_button</span><span class="p">,</span> <span class="n">toolbar_button</span><span class="p">]</span>
    <span class="n">toolbar_footer</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
    <span class="n">toolbar_footer</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">buttons</span><span class="p">,</span>
        <span class="n">output</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">toolbar_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
    <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>

    <span class="n">toolbar_event</span> <span class="o">=</span> <span class="n">ipyevents</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">toolbar_widget</span><span class="p">,</span> <span class="n">watched_events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseleave&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">marker_callback</span><span class="p">(</span><span class="n">chooser</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chooser</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">chooser</span><span class="o">.</span><span class="n">selected</span><span class="p">)</span>
                    <span class="n">centroids</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">centroid</span>
                    <span class="n">coords</span> <span class="o">=</span> <span class="p">[[</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">centroids</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">plus_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">is_colab</span><span class="p">():</span>  <span class="c1"># Colab does not support AwesomeIcon</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
                                    <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                    <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                                    <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                    <span class="n">icon</span><span class="o">=</span><span class="n">ipyleaflet</span><span class="o">.</span><span class="n">AwesomeIcon</span><span class="p">(</span>
                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plus-circle&quot;</span><span class="p">,</span>
                                        <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                        <span class="n">icon_color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span>
                                    <span class="p">),</span>
                                <span class="p">)</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">fg_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                            <span class="n">fg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">minus_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">is_colab</span><span class="p">():</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
                                    <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                    <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                    <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                                    <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                    <span class="n">icon</span><span class="o">=</span><span class="n">ipyleaflet</span><span class="o">.</span><span class="n">AwesomeIcon</span><span class="p">(</span>
                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;minus-circle&quot;</span><span class="p">,</span>
                                        <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                        <span class="n">icon_color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span>
                                    <span class="p">),</span>
                                <span class="p">)</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">bg_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                            <span class="n">bg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">marker_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">marker_control</span><span class="p">)</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;marker_control&quot;</span><span class="p">)</span>

            <span class="n">plus_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">minus_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">marker_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">sandbox_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SANDBOX_PATH&quot;</span><span class="p">)</span>
            <span class="n">filechooser</span> <span class="o">=</span> <span class="n">FileChooser</span><span class="p">(</span>
                <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                <span class="n">sandbox_path</span><span class="o">=</span><span class="n">sandbox_path</span><span class="p">,</span>
                <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;454px&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">filechooser</span><span class="o">.</span><span class="n">use_dir_icons</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">filechooser</span><span class="o">.</span><span class="n">filter_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.shp&quot;</span><span class="p">,</span> <span class="s2">&quot;*.geojson&quot;</span><span class="p">,</span> <span class="s2">&quot;*.gpkg&quot;</span><span class="p">]</span>
            <span class="n">filechooser</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">marker_callback</span><span class="p">)</span>
            <span class="n">marker_control</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">WidgetControl</span><span class="p">(</span>
                <span class="n">widget</span><span class="o">=</span><span class="n">filechooser</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;topright&quot;</span>
            <span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">marker_control</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">marker_control</span> <span class="o">=</span> <span class="n">marker_control</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;marker_control&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">marker_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">marker_control</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">marker_control</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plus_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">marker_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="n">minus_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">marker_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_toolbar_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mouseenter&quot;</span><span class="p">:</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mouseleave&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_button</span><span class="p">]</span>
                <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">close_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">toolbar_event</span><span class="o">.</span><span class="n">on_dom_event</span><span class="p">(</span><span class="n">handle_toolbar_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toolbar_btn_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">close_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">close_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_button</span><span class="p">]</span>

    <span class="n">toolbar_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">toolbar_btn_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close_btn_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span><span class="p">)</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">close_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">close_btn_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_map_interaction</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;click&quot;</span><span class="p">:</span>
                <span class="n">latlon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">radio_buttons</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Foreground&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_colab</span><span class="p">():</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
                            <span class="n">location</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">latlon</span><span class="p">),</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                            <span class="n">location</span><span class="o">=</span><span class="n">latlon</span><span class="p">,</span>
                            <span class="n">icon</span><span class="o">=</span><span class="n">ipyleaflet</span><span class="o">.</span><span class="n">AwesomeIcon</span><span class="p">(</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;plus-circle&quot;</span><span class="p">,</span>
                                <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                <span class="n">icon_color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="n">fg_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">fg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">radio_buttons</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_colab</span><span class="p">():</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">CircleMarker</span><span class="p">(</span>
                            <span class="n">location</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">latlon</span><span class="p">),</span>
                            <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                            <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">marker</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
                            <span class="n">location</span><span class="o">=</span><span class="n">latlon</span><span class="p">,</span>
                            <span class="n">icon</span><span class="o">=</span><span class="n">ipyleaflet</span><span class="o">.</span><span class="n">AwesomeIcon</span><span class="p">(</span>
                                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;minus-circle&quot;</span><span class="p">,</span>
                                <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
                                <span class="n">icon_color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="n">bg_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">bg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error handling map interaction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">on_interaction</span><span class="p">(</span><span class="n">handle_map_interaction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">segment_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please add some foreground markers.&quot;</span><span class="p">)</span>
                    <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">return</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fg_points</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span>
                        <span class="p">]</span>
                        <span class="n">bg_points</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span>
                        <span class="p">]</span>
                        <span class="n">point_coords</span> <span class="o">=</span> <span class="n">fg_points</span> <span class="o">+</span> <span class="n">bg_points</span>
                        <span class="n">point_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">fg_points</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">bg_points</span><span class="p">)</span>

                        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;masks_</span><span class="si">{</span><span class="n">random_string</span><span class="p">()</span><span class="si">}</span><span class="s2">.tif&quot;</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                        <span class="n">sam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                            <span class="n">point_coords</span><span class="o">=</span><span class="n">point_coords</span><span class="p">,</span>
                            <span class="n">point_labels</span><span class="o">=</span><span class="n">point_labels</span><span class="p">,</span>
                            <span class="n">point_crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
                            <span class="n">output</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Masks&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Masks&quot;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Regularized&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Regularized&quot;</span><span class="p">))</span>

                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sam</span><span class="p">,</span> <span class="s2">&quot;prediction_fp&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                            <span class="n">sam</span><span class="o">.</span><span class="n">prediction_fp</span>
                        <span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">prediction_fp</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">pass</span>

                        <span class="c1"># Skip the image layer if localtileserver is not available</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span>
                                <span class="n">filename</span><span class="p">,</span>
                                <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
                                <span class="n">opacity</span><span class="o">=</span><span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;Masks&quot;</span><span class="p">,</span>
                                <span class="n">zoom_to_layer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="p">)</span>

                            <span class="k">if</span> <span class="n">rectangular</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                                <span class="n">vector</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.gpkg&quot;</span><span class="p">)</span>
                                <span class="n">vector_rec</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_rect.gpkg&quot;</span><span class="p">)</span>
                                <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
                                <span class="n">regularize</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_rec</span><span class="p">)</span>
                                <span class="n">vector_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colorpicker</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
                                <span class="n">m</span><span class="o">.</span><span class="n">add_vector</span><span class="p">(</span>
                                    <span class="n">vector_rec</span><span class="p">,</span>
                                    <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;Regularized&quot;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">vector_style</span><span class="p">,</span>
                                    <span class="n">info_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">zoom_to_layer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="p">)</span>

                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                        <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">sam</span><span class="o">.</span><span class="n">prediction_fp</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">segment_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">segment_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filechooser_callback</span><span class="p">(</span><span class="n">chooser</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chooser</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">chooser</span><span class="o">.</span><span class="n">selected</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">prediction_fp</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">vector</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.gpkg&quot;</span><span class="p">)</span>
                    <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rectangular</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">vector_rec</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_rect.gpkg&quot;</span><span class="p">)</span>
                        <span class="n">regularize</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_rec</span><span class="p">)</span>

                    <span class="n">fg_points</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span>
                    <span class="p">]</span>
                    <span class="n">bg_points</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span>
                    <span class="p">]</span>

                    <span class="n">coords_to_geojson</span><span class="p">(</span>
                        <span class="n">fg_points</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_fg_markers.geojson&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">coords_to_geojson</span><span class="p">(</span>
                        <span class="n">bg_points</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_bg_markers.geojson&quot;</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">save_control</span><span class="p">)</span>
                    <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span>
                <span class="n">save_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">save_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">sandbox_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SANDBOX_PATH&quot;</span><span class="p">)</span>
                <span class="n">filechooser</span> <span class="o">=</span> <span class="n">FileChooser</span><span class="p">(</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;masks.tif&quot;</span><span class="p">,</span>
                    <span class="n">sandbox_path</span><span class="o">=</span><span class="n">sandbox_path</span><span class="p">,</span>
                    <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;454px&quot;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">filechooser</span><span class="o">.</span><span class="n">use_dir_icons</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">filechooser</span><span class="o">.</span><span class="n">filter_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.tif&quot;</span><span class="p">]</span>
                <span class="n">filechooser</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">filechooser_callback</span><span class="p">)</span>
                <span class="n">save_control</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">WidgetControl</span><span class="p">(</span>
                    <span class="n">widget</span><span class="o">=</span><span class="n">filechooser</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;topright&quot;</span>
                <span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">save_control</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="o">=</span> <span class="n">save_control</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">save_control</span><span class="p">)</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span>

    <span class="n">save_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">save_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">reset_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">rectangular</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">colorpicker</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;#ffff00&quot;</span>
            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Masks&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Regularized&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="s2">&quot;Regularized&quot;</span><span class="p">))</span>
                <span class="n">m</span><span class="o">.</span><span class="n">clear_drawings</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;fg_markers&quot;</span><span class="p">):</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">user_rois</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">fg_markers</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">bg_markers</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">fg_layer</span><span class="o">.</span><span class="n">clear_layers</span><span class="p">()</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">bg_layer</span><span class="o">.</span><span class="n">clear_layers</span><span class="p">()</span>
                    <span class="n">fg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">bg_count</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">prediction_fp</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">reset_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">reset_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="n">toolbar_control</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">WidgetControl</span><span class="p">(</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">toolbar_widget</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;topright&quot;</span>
    <span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">toolbar_control</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span> <span class="o">=</span> <span class="n">toolbar_control</span>

    <span class="k">return</span> <span class="n">m</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.show_canvas" class="doc doc-heading">
<code class="highlight language-python"><span class="n">show_canvas</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>


<a href="#samgeo.common.show_canvas" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Show a canvas to collect foreground and background points.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>image</code></td>
        <td><code>str | np.ndarray</code></td>
        <td><p>The input image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>fg_color</code></td>
        <td><code>tuple</code></td>
        <td><p>The color for the foreground points. Defaults to (0, 255, 0).</p></td>
        <td><code>(0, 255, 0)</code></td>
      </tr>
      <tr>
        <td><code>bg_color</code></td>
        <td><code>tuple</code></td>
        <td><p>The color for the background points. Defaults to (0, 0, 255).</p></td>
        <td><code>(0, 0, 255)</code></td>
      </tr>
      <tr>
        <td><code>radius</code></td>
        <td><code>int</code></td>
        <td><p>The radius of the points. Defaults to 5.</p></td>
        <td><code>5</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>tuple</code></td>
      <td><p>A tuple of two lists of foreground and background points.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">show_canvas</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a canvas to collect foreground and background points.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (str | np.ndarray): The input image.</span>
<span class="sd">        fg_color (tuple, optional): The color for the foreground points. Defaults to (0, 255, 0).</span>
<span class="sd">        bg_color (tuple, optional): The color for the background points. Defaults to (0, 0, 255).</span>
<span class="sd">        radius (int, optional): The radius of the points. Defaults to 5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple of two lists of foreground and background points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input image must be a URL or a NumPy array.&quot;</span><span class="p">)</span>

    <span class="c1"># Create an empty list to store the mouse click coordinates</span>
    <span class="n">left_clicks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">right_clicks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create a mouse callback function</span>
    <span class="k">def</span> <span class="nf">get_mouse_coordinates</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_LBUTTONDOWN</span><span class="p">:</span>
            <span class="c1"># Append the coordinates to the mouse_clicks list</span>
            <span class="n">left_clicks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

            <span class="c1"># Draw a green circle at the mouse click coordinates</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">fg_color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Show the updated image with the circle</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="n">cv2</span><span class="o">.</span><span class="n">EVENT_RBUTTONDOWN</span><span class="p">:</span>
            <span class="c1"># Append the coordinates to the mouse_clicks list</span>
            <span class="n">right_clicks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

            <span class="c1"># Draw a red circle at the mouse click coordinates</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Show the updated image with the circle</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="c1"># Create a window to display the image</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">namedWindow</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>

    <span class="c1"># Set the mouse callback function for the window</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">setMouseCallback</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">get_mouse_coordinates</span><span class="p">)</span>

    <span class="c1"># Display the image in the window</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

    <span class="c1"># Wait for a key press to exit</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Destroy the window</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">left_clicks</span><span class="p">,</span> <span class="n">right_clicks</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.split_raster" class="doc doc-heading">
<code class="highlight language-python"><span class="n">split_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a href="#samgeo.common.split_raster" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Split a raster into tiles.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filename</code></td>
        <td><code>str</code></td>
        <td><p>The path or http URL to the raster file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>str</code></td>
        <td><p>The path to the output directory.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>tile_size</code></td>
        <td><code>int | tuple</code></td>
        <td><p>The size of the tiles. Can be an integer or a tuple of (width, height). Defaults to 256.</p></td>
        <td><code>256</code></td>
      </tr>
      <tr>
        <td><code>overlap</code></td>
        <td><code>int</code></td>
        <td><p>The number of pixels to overlap between tiles. Defaults to 0.</p></td>
        <td><code>0</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ImportError</code></td>
        <td><p>Raised if GDAL is not installed.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">split_raster</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split a raster into tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The path or http URL to the raster file.</span>
<span class="sd">        out_dir (str): The path to the output directory.</span>
<span class="sd">        tile_size (int | tuple, optional): The size of the tiles. Can be an integer or a tuple of (width, height). Defaults to 256.</span>
<span class="sd">        overlap (int, optional): The number of pixels to overlap between tiles. Defaults to 0.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: Raised if GDAL is not installed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;GDAL is required to use this function. Install it with `conda install gdal -c conda-forge`&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">download_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">output</span>

    <span class="c1"># Open the input GeoTIFF file</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">tile_width</span> <span class="o">=</span> <span class="n">tile_size</span>
        <span class="n">tile_height</span> <span class="o">=</span> <span class="n">tile_size</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">tile_width</span> <span class="o">=</span> <span class="n">tile_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tile_height</span> <span class="o">=</span> <span class="n">tile_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get the size of the input raster</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterXSize</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">RasterYSize</span>

    <span class="c1"># Calculate the number of tiles needed in both directions, taking into account the overlap</span>
    <span class="n">num_tiles_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">tile_width</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
        <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">tile_width</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">)</span>
    <span class="n">num_tiles_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">tile_height</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
        <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">tile_height</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="c1"># Get the georeferencing information of the input raster</span>
    <span class="n">geotransform</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>

    <span class="c1"># Loop over all the tiles</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tiles_x</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_tiles_y</span><span class="p">):</span>
            <span class="c1"># Calculate the pixel coordinates of the tile, taking into account the overlap and clamping to the edge of the raster</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">tile_width</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">tile_height</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">)</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_min</span> <span class="o">+</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_min</span> <span class="o">+</span> <span class="n">tile_height</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

            <span class="c1"># Adjust the size of the last tile in each row and column to include any remaining pixels</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_tiles_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">tile_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">num_tiles_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">tile_height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Calculate the size of the tile, taking into account the overlap</span>
            <span class="n">tile_width</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
            <span class="n">tile_height</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>

            <span class="c1"># Set the output file name</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/tile_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">.tif&quot;</span>

            <span class="c1"># Create a new dataset for the tile</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;GTiff&quot;</span><span class="p">)</span>
            <span class="n">tile_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span>
                <span class="n">output_file</span><span class="p">,</span>
                <span class="n">tile_width</span><span class="p">,</span>
                <span class="n">tile_height</span><span class="p">,</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">,</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Calculate the georeferencing information for the output tile</span>
            <span class="n">tile_geotransform</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">geotransform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_min</span> <span class="o">*</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">geotransform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">geotransform</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_min</span> <span class="o">*</span> <span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">geotransform</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="c1"># Set the geotransform and projection of the tile</span>
            <span class="n">tile_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">tile_geotransform</span><span class="p">)</span>
            <span class="n">tile_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">())</span>

            <span class="c1"># Read the data from the input raster band(s) and write it to the tile band(s)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">RasterCount</span><span class="p">):</span>
                <span class="n">band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">tile_band</span> <span class="o">=</span> <span class="n">tile_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">tile_data</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">)</span>
                <span class="n">tile_band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">tile_data</span><span class="p">)</span>

            <span class="c1"># Close the tile dataset</span>
            <span class="n">tile_ds</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Close the input dataset</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.temp_file_path" class="doc doc-heading">
<code class="highlight language-python"><span class="n">temp_file_path</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span></code>


<a href="#samgeo.common.temp_file_path" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Returns a temporary file path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>extension</code></td>
        <td><code>str</code></td>
        <td><p>The file extension.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The temporary file path.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">temp_file_path</span><span class="p">(</span><span class="n">extension</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a temporary file path.</span>

<span class="sd">    Args:</span>
<span class="sd">        extension (str): The file extension.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The temporary file path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">tempfile</span>
    <span class="kn">import</span> <span class="nn">uuid</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">extension</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">extension</span>
    <span class="n">file_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_id</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_path</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.text_sam_gui" class="doc doc-heading">
<code class="highlight language-python"><span class="n">text_sam_gui</span><span class="p">(</span><span class="n">sam</span><span class="p">,</span> <span class="n">basemap</span><span class="o">=</span><span class="s1">&#39;SATELLITE&#39;</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">box_threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">text_threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.text_sam_gui" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Display the SAM Map GUI.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>sam</code></td>
        <td><code>SamGeo</code></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>basemap</code></td>
        <td><code>str</code></td>
        <td><p>The basemap to use. Defaults to "SATELLITE".</p></td>
        <td><code>&#39;SATELLITE&#39;</code></td>
      </tr>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>str</code></td>
        <td><p>The output directory. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">text_sam_gui</span><span class="p">(</span>
    <span class="n">sam</span><span class="p">,</span>
    <span class="n">basemap</span><span class="o">=</span><span class="s2">&quot;SATELLITE&quot;</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">box_threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">text_threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the SAM Map GUI.</span>

<span class="sd">    Args:</span>
<span class="sd">        sam (SamGeo):</span>
<span class="sd">        basemap (str, optional): The basemap to use. Defaults to &quot;SATELLITE&quot;.</span>
<span class="sd">        out_dir (str, optional): The output directory. Defaults to None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="kn">import</span> <span class="nn">tempfile</span>
        <span class="kn">import</span> <span class="nn">leafmap</span>
        <span class="kn">import</span> <span class="nn">ipyleaflet</span>
        <span class="kn">import</span> <span class="nn">ipyevents</span>
        <span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
        <span class="kn">import</span> <span class="nn">leafmap.colormaps</span> <span class="k">as</span> <span class="nn">cm</span>
        <span class="kn">from</span> <span class="nn">ipyfilechooser</span> <span class="kn">import</span> <span class="n">FileChooser</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The sam_map function requires the leafmap package. Please install it first.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">leafmap</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">default_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cursor&quot;</span><span class="p">:</span> <span class="s2">&quot;crosshair&quot;</span><span class="p">}</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Skip the image layer if localtileserver is not available</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">widget_width</span> <span class="o">=</span> <span class="s2">&quot;280px&quot;</span>
    <span class="n">button_width</span> <span class="o">=</span> <span class="s2">&quot;90px&quot;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;0px 4px 0px 4px&quot;</span>  <span class="c1"># upper, right, bottom, left</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description_width&quot;</span><span class="p">:</span> <span class="s2">&quot;initial&quot;</span><span class="p">}</span>

    <span class="n">toolbar_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Toolbar&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;gear&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;0px 0px 0px 4px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">close_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">tooltip</span><span class="o">=</span><span class="s2">&quot;Close the tool&quot;</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;times&quot;</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;28px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;0px 0px 0px 4px&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">text_prompt</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Text prompt:&quot;</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">box_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Box threshold:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">box_threshold</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">text_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Text threshold:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">text_threshold</span><span class="p">,</span>
        <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cmap_dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Palette:&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">list_colormaps</span><span class="p">(),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">opacity_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Opacity:&quot;</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
        <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">opacity_changed</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;layer_name&quot;</span><span class="p">):</span>
                <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">layer_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mask_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mask_layer</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">opacity_slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">opacity_changed</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="n">rectangular</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Regularize&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;130px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">colorpicker</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ColorPicker</span><span class="p">(</span>
        <span class="n">concise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Color&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#ffff00&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;140px&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">segment_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Segment&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">save_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span>
    <span class="p">)</span>

    <span class="n">reset_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button_style</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span>
    <span class="p">)</span>
    <span class="n">segment_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>
    <span class="n">save_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>
    <span class="n">reset_button</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">button_width</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="n">widget_width</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">widget_width</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">toolbar_header</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">()</span>
    <span class="n">toolbar_header</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">close_button</span><span class="p">,</span> <span class="n">toolbar_button</span><span class="p">]</span>
    <span class="n">toolbar_footer</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
    <span class="n">toolbar_footer</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">text_prompt</span><span class="p">,</span>
        <span class="n">box_slider</span><span class="p">,</span>
        <span class="n">text_slider</span><span class="p">,</span>
        <span class="n">cmap_dropdown</span><span class="p">,</span>
        <span class="n">opacity_slider</span><span class="p">,</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">rectangular</span><span class="p">,</span> <span class="n">colorpicker</span><span class="p">]),</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span>
            <span class="p">[</span><span class="n">segment_button</span><span class="p">,</span> <span class="n">save_button</span><span class="p">,</span> <span class="n">reset_button</span><span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="s2">&quot;0px 4px 0px 4px&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">output</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">toolbar_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
    <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>

    <span class="n">toolbar_event</span> <span class="o">=</span> <span class="n">ipyevents</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">toolbar_widget</span><span class="p">,</span> <span class="n">watched_events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseleave&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_toolbar_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mouseenter&quot;</span><span class="p">:</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;mouseleave&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_button</span><span class="p">]</span>
                <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">close_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">toolbar_event</span><span class="o">.</span><span class="n">on_dom_event</span><span class="p">(</span><span class="n">handle_toolbar_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">toolbar_btn_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">close_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_header</span><span class="p">,</span> <span class="n">toolbar_footer</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">close_button</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">toolbar_button</span><span class="p">]</span>

    <span class="n">toolbar_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">toolbar_btn_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close_btn_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">toolbar_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span><span class="p">)</span>
            <span class="n">toolbar_widget</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">close_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">close_btn_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">segment_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_prompt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please enter a text prompt first.&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">sam</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please run sam.set_image() first.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Segmenting...&quot;</span><span class="p">)</span>
                    <span class="n">layer_name</span> <span class="o">=</span> <span class="n">text_prompt</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random_string</span><span class="p">()</span><span class="si">}</span><span class="s2">.tif&quot;</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">sam</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                            <span class="n">sam</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                            <span class="n">text_prompt</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">box_slider</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">text_slider</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="n">output</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">sam</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">filename</span>
                        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="n">layer_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="n">layer_name</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">_rect&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2"> Regularized&quot;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">add_raster</span><span class="p">(</span>
                                <span class="n">filename</span><span class="p">,</span>
                                <span class="n">layer_name</span><span class="o">=</span><span class="n">layer_name</span><span class="p">,</span>
                                <span class="n">palette</span><span class="o">=</span><span class="n">cmap_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">opacity</span><span class="o">=</span><span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                <span class="n">nodata</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">zoom_to_layer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">m</span><span class="o">.</span><span class="n">layer_name</span> <span class="o">=</span> <span class="n">layer_name</span>

                            <span class="k">if</span> <span class="n">rectangular</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                                <span class="n">vector</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.gpkg&quot;</span><span class="p">)</span>
                                <span class="n">vector_rec</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_rect.gpkg&quot;</span><span class="p">)</span>
                                <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
                                <span class="n">regularize</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_rec</span><span class="p">)</span>
                                <span class="n">vector_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colorpicker</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
                                <span class="n">m</span><span class="o">.</span><span class="n">add_vector</span><span class="p">(</span>
                                    <span class="n">vector_rec</span><span class="p">,</span>
                                    <span class="n">layer_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2"> Regularized&quot;</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">vector_style</span><span class="p">,</span>
                                    <span class="n">info_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                    <span class="n">zoom_to_layer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="p">)</span>

                            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="n">segment_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">segment_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filechooser_callback</span><span class="p">(</span><span class="n">chooser</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chooser</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">chooser</span><span class="o">.</span><span class="n">selected</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sam</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">vector</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;.gpkg&quot;</span><span class="p">)</span>
                    <span class="n">raster_to_vector</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rectangular</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">vector_rec</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;_rect.gpkg&quot;</span><span class="p">)</span>
                        <span class="n">regularize</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">vector_rec</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">save_control</span><span class="p">)</span>
                    <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span>
                <span class="n">save_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">save_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;layer_name&quot;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please click the Segment button first.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sandbox_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SANDBOX_PATH&quot;</span><span class="p">)</span>
                    <span class="n">filechooser</span> <span class="o">=</span> <span class="n">FileChooser</span><span class="p">(</span>
                        <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">,</span>
                        <span class="n">sandbox_path</span><span class="o">=</span><span class="n">sandbox_path</span><span class="p">,</span>
                        <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;454px&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">filechooser</span><span class="o">.</span><span class="n">use_dir_icons</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">filechooser</span><span class="o">.</span><span class="n">filter_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.tif&quot;</span><span class="p">]</span>
                    <span class="n">filechooser</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">filechooser_callback</span><span class="p">)</span>
                    <span class="n">save_control</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">WidgetControl</span><span class="p">(</span>
                        <span class="n">widget</span><span class="o">=</span><span class="n">filechooser</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;topright&quot;</span>
                    <span class="p">)</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">save_control</span><span class="p">)</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="o">=</span> <span class="n">save_control</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">save_control</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">controls</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">remove_control</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">save_control</span><span class="p">)</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;save_control&quot;</span><span class="p">)</span>

    <span class="n">save_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">save_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset_button_click</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]:</span>
            <span class="n">segment_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">save_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">reset_button</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">opacity_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">box_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">text_slider</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">cmap_dropdown</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span>
            <span class="n">text_prompt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;layer_name&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">layer_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">remove_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">find_layer</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">layer_name</span><span class="p">))</span>
                <span class="n">m</span><span class="o">.</span><span class="n">clear_drawings</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="n">reset_button</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">reset_button_click</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="n">toolbar_control</span> <span class="o">=</span> <span class="n">ipyleaflet</span><span class="o">.</span><span class="n">WidgetControl</span><span class="p">(</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">toolbar_widget</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;topright&quot;</span>
    <span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_control</span><span class="p">(</span><span class="n">toolbar_control</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">toolbar_control</span> <span class="o">=</span> <span class="n">toolbar_control</span>

    <span class="k">return</span> <span class="n">m</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.tms_to_geotiff" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tms_to_geotiff</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;OpenStreetMap&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:3857&#39;</span><span class="p">,</span> <span class="n">to_cog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.tms_to_geotiff" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Download TMS tiles and convert them to a GeoTIFF. The source is adapted from https://github.com/gumblex/tms2geotiff.
    Credits to the GitHub user @gumblex.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output GeoTIFF file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bbox</code></td>
        <td><code>list</code></td>
        <td><p>The bounding box [minx, miny, maxx, maxy], e.g., [-122.5216, 37.733, -122.3661, 37.8095]</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>zoom</code></td>
        <td><code>int</code></td>
        <td><p>The map zoom level. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>resolution</code></td>
        <td><code>float</code></td>
        <td><p>The resolution in meters. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>source</code></td>
        <td><code>str</code></td>
        <td><p>The tile source. It can be one of the following: "OPENSTREETMAP", "ROADMAP",
"SATELLITE", "TERRAIN", "HYBRID", or an HTTP URL. Defaults to "OpenStreetMap".</p></td>
        <td><code>&#39;OpenStreetMap&#39;</code></td>
      </tr>
      <tr>
        <td><code>crs</code></td>
        <td><code>str</code></td>
        <td><p>The output CRS. Defaults to "EPSG:3857".</p></td>
        <td><code>&#39;EPSG:3857&#39;</code></td>
      </tr>
      <tr>
        <td><code>to_cog</code></td>
        <td><code>bool</code></td>
        <td><p>Convert to Cloud Optimized GeoTIFF. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>return_image</code></td>
        <td><code>bool</code></td>
        <td><p>Return the image as PIL.Image. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>Overwrite the output file if it already exists. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>quiet</code></td>
        <td><code>bool</code></td>
        <td><p>Suppress output. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional arguments to pass to gdal.GetDriverByName("GTiff").Create().</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tms_to_geotiff</span><span class="p">(</span>
    <span class="n">output</span><span class="p">,</span>
    <span class="n">bbox</span><span class="p">,</span>
    <span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;OpenStreetMap&quot;</span><span class="p">,</span>
    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">,</span>
    <span class="n">to_cog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">return_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download TMS tiles and convert them to a GeoTIFF. The source is adapted from https://github.com/gumblex/tms2geotiff.</span>
<span class="sd">        Credits to the GitHub user @gumblex.</span>

<span class="sd">    Args:</span>
<span class="sd">        output (str): The output GeoTIFF file.</span>
<span class="sd">        bbox (list): The bounding box [minx, miny, maxx, maxy], e.g., [-122.5216, 37.733, -122.3661, 37.8095]</span>
<span class="sd">        zoom (int, optional): The map zoom level. Defaults to None.</span>
<span class="sd">        resolution (float, optional): The resolution in meters. Defaults to None.</span>
<span class="sd">        source (str, optional): The tile source. It can be one of the following: &quot;OPENSTREETMAP&quot;, &quot;ROADMAP&quot;,</span>
<span class="sd">            &quot;SATELLITE&quot;, &quot;TERRAIN&quot;, &quot;HYBRID&quot;, or an HTTP URL. Defaults to &quot;OpenStreetMap&quot;.</span>
<span class="sd">        crs (str, optional): The output CRS. Defaults to &quot;EPSG:3857&quot;.</span>
<span class="sd">        to_cog (bool, optional): Convert to Cloud Optimized GeoTIFF. Defaults to False.</span>
<span class="sd">        return_image (bool, optional): Return the image as PIL.Image. Defaults to False.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the output file if it already exists. Defaults to False.</span>
<span class="sd">        quiet (bool, optional): Suppress output. Defaults to False.</span>
<span class="sd">        **kwargs: Additional arguments to pass to gdal.GetDriverByName(&quot;GTiff&quot;).Create().</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="kn">import</span> <span class="nn">itertools</span>
    <span class="kn">import</span> <span class="nn">concurrent.futures</span>

    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">osr</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;GDAL is not installed. Install it with pip install GDAL&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">httpx</span>

        <span class="n">SESSION</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">requests</span>

        <span class="n">SESSION</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The output file </span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2"> already exists. Use `overwrite=True` to overwrite it.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">xyz_tiles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;OPENSTREETMAP&quot;</span><span class="p">:</span> <span class="s2">&quot;https://tile.openstreetmap.org/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.png&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ROADMAP&quot;</span><span class="p">:</span> <span class="s2">&quot;https://mt1.google.com/vt/lyrs=m&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SATELLITE&quot;</span><span class="p">:</span> <span class="s2">&quot;https://mt1.google.com/vt/lyrs=s&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TERRAIN&quot;</span><span class="p">:</span> <span class="s2">&quot;https://mt1.google.com/vt/lyrs=p&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HYBRID&quot;</span><span class="p">:</span> <span class="s2">&quot;https://mt1.google.com/vt/lyrs=y&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">basemaps</span> <span class="o">=</span> <span class="n">get_basemaps</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">xyz_tiles</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">xyz_tiles</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">basemaps</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">basemaps</span><span class="p">[</span><span class="n">source</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;source must be one of &quot;OpenStreetMap&quot;, &quot;ROADMAP&quot;, &quot;SATELLITE&quot;, &quot;TERRAIN&quot;, &quot;HYBRID&quot;, or a URL&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">resolution_to_zoom_level</span><span class="p">(</span><span class="n">resolution</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert map resolution in meters to zoom level for Web Mercator (EPSG:3857) tiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Web Mercator tile size in meters at zoom level 0</span>
        <span class="n">initial_resolution</span> <span class="o">=</span> <span class="mf">156543.03392804097</span>

        <span class="c1"># Calculate the zoom level</span>
        <span class="n">zoom_level</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">initial_resolution</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">zoom_level</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;bbox must be a list of 4 coordinates in the format of [xmin, ymin, xmax, ymax]&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either zoom or resolution must be provided&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of zoom or resolution can be provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">resolution_to_zoom_level</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>

    <span class="n">EARTH_EQUATORIAL_RADIUS</span> <span class="o">=</span> <span class="mf">6378137.0</span>

    <span class="n">Image</span><span class="o">.</span><span class="n">MAX_IMAGE_PIXELS</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">gdal</span><span class="o">.</span><span class="n">UseExceptions</span><span class="p">()</span>
    <span class="n">web_mercator</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="n">web_mercator</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>

    <span class="n">WKT_3857</span> <span class="o">=</span> <span class="n">web_mercator</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">from4326_to3857</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
        <span class="n">xtile</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">*</span> <span class="n">EARTH_EQUATORIAL_RADIUS</span>
        <span class="n">ytile</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">45</span> <span class="o">+</span> <span class="n">lat</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)))</span> <span class="o">*</span> <span class="n">EARTH_EQUATORIAL_RADIUS</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">xtile</span><span class="p">,</span> <span class="n">ytile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deg2num</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">zoom</span><span class="p">):</span>
        <span class="n">lat_r</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">zoom</span>
        <span class="n">xtile</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">/</span> <span class="mi">360</span> <span class="o">*</span> <span class="n">n</span>
        <span class="n">ytile</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">lat_r</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_r</span><span class="p">))</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">xtile</span><span class="p">,</span> <span class="n">ytile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
        <span class="n">extrema</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">getextrema</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrema</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">extrema</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extrema</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">paste_tile</span><span class="p">(</span><span class="n">bigim</span><span class="p">,</span> <span class="n">base_size</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">corner_xy</span><span class="p">,</span> <span class="n">bbox</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bigim</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">tile</span><span class="p">))</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;RGB&quot;</span> <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGB&quot;</span> <span class="k">else</span> <span class="s2">&quot;RGBA&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">bigim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">base_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newim</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                <span class="n">mode</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newim</span> <span class="o">=</span> <span class="n">bigim</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">corner_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">corner_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">xy0</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGB&quot;</span><span class="p">:</span>
            <span class="n">newim</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">xy0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_empty</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
                <span class="n">newim</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">xy0</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">newim</span>

    <span class="k">def</span> <span class="nf">finish_picture</span><span class="p">(</span><span class="n">bigim</span><span class="p">,</span> <span class="n">base_size</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
        <span class="n">xfrac</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yfrac</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">base_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">xfrac</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">base_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">yfrac</span><span class="p">)</span>
        <span class="n">imgw</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">base_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">))</span>
        <span class="n">imgh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">base_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">))</span>
        <span class="n">retim</span> <span class="o">=</span> <span class="n">bigim</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">imgw</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">imgh</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">retim</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGBA&quot;</span> <span class="ow">and</span> <span class="n">retim</span><span class="o">.</span><span class="n">getextrema</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">):</span>
            <span class="n">retim</span> <span class="o">=</span> <span class="n">retim</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
        <span class="n">bigim</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">retim</span>

    <span class="k">def</span> <span class="nf">get_tile</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">SESSION</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">retry</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">retry</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">draw_tile</span><span class="p">(</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">deg2num</span><span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">deg2num</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span>
        <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x1</span><span class="p">)),</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">y1</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">totalnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
                <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">get_tile</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">y0</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">y1</span><span class="p">))</span>
            <span class="n">bigim</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">base_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">fut</span><span class="p">,</span> <span class="n">corner_xy</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">futures</span><span class="p">,</span> <span class="n">corners</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">bigim</span> <span class="o">=</span> <span class="n">paste_tile</span><span class="p">(</span><span class="n">bigim</span><span class="p">,</span> <span class="n">base_size</span><span class="p">,</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">(),</span> <span class="n">corner_xy</span><span class="p">,</span> <span class="n">bbox</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Downloaded image </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalnum</span><span class="p">)))</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">totalnum</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving GeoTIFF. Please wait...&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">finish_picture</span><span class="p">(</span><span class="n">bigim</span><span class="p">,</span> <span class="n">base_size</span><span class="p">,</span> <span class="n">bbox</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
        <span class="n">imgbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getbands</span><span class="p">())</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;GTiff&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;options&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;COMPRESS=DEFLATE&quot;</span><span class="p">,</span>
                <span class="s2">&quot;PREDICTOR=2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ZLEVEL=9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;TILED=YES&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="n">gtiff</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">imgbands</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xp0</span><span class="p">,</span> <span class="n">yp0</span> <span class="o">=</span> <span class="n">from4326_to3857</span><span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="p">)</span>
        <span class="n">xp1</span><span class="p">,</span> <span class="n">yp1</span> <span class="o">=</span> <span class="n">from4326_to3857</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">)</span>
        <span class="n">pwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xp1</span> <span class="o">-</span> <span class="n">xp0</span><span class="p">)</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pheight</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yp1</span> <span class="o">-</span> <span class="n">yp0</span><span class="p">)</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">gtiff</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">xp0</span><span class="p">,</span> <span class="n">xp1</span><span class="p">),</span> <span class="n">pwidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">yp0</span><span class="p">,</span> <span class="n">yp1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">pheight</span><span class="p">))</span>
        <span class="n">gtiff</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">WKT_3857</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">imgbands</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">band</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;u8&quot;</span><span class="p">)</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">band</span> <span class="o">=</span> <span class="n">gtiff</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">gtiff</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">draw_tile</span><span class="p">(</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">north</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">quiet</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">return_image</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="k">if</span> <span class="n">crs</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;EPSG:3857&quot;</span><span class="p">:</span>
            <span class="n">reproject</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">to_cog</span><span class="o">=</span><span class="n">to_cog</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">to_cog</span><span class="p">:</span>
            <span class="n">image_to_cog</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.transform_coords" class="doc doc-heading">
<code class="highlight language-python"><span class="n">transform_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.transform_coords" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Transform coordinates from one CRS to another.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>x</code></td>
        <td><code>float</code></td>
        <td><p>The x coordinate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>y</code></td>
        <td><code>float</code></td>
        <td><p>The y coordinate.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src_crs</code></td>
        <td><code>str</code></td>
        <td><p>The source CRS, e.g., "EPSG:4326".</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst_crs</code></td>
        <td><code>str</code></td>
        <td><p>The destination CRS, e.g., "EPSG:3857".</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>The transformed coordinates in the format of (x, y)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transform_coords</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform coordinates from one CRS to another.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (float): The x coordinate.</span>
<span class="sd">        y (float): The y coordinate.</span>
<span class="sd">        src_crs (str): The source CRS, e.g., &quot;EPSG:4326&quot;.</span>
<span class="sd">        dst_crs (str): The destination CRS, e.g., &quot;EPSG:3857&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The transformed coordinates in the format of (x, y)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span>
        <span class="n">src_crs</span><span class="p">,</span> <span class="n">dst_crs</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.update_package" class="doc doc-heading">
<code class="highlight language-python"><span class="n">update_package</span><span class="p">(</span><span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.update_package" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Updates the package from the GitHub repository without the need to use pip or conda.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>out_dir</code></td>
        <td><code>str</code></td>
        <td><p>The output directory. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>keep</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to keep the downloaded package. Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td></td>
        <td><p>Additional keyword arguments to pass to the download_file() function.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_package</span><span class="p">(</span><span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the package from the GitHub repository without the need to use pip or conda.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_dir (str, optional): The output directory. Defaults to None.</span>
<span class="sd">        keep (bool, optional): Whether to keep the downloaded package. Defaults to False.</span>
<span class="sd">        **kwargs: Additional keyword arguments to pass to the download_file() function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">shutil</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://github.com/opengeos/segment-geospatial/archive/refs/heads/main.zip&quot;</span>
        <span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;segment-geospatial-main.zip&quot;</span>
        <span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">pkg_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;segment-geospatial-main&quot;</span><span class="p">)</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">pkg_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pip&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;pip3 install .&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;pip install .&quot;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">pkg_dir</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Package updated successfully.&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h2 id="samgeo.common.vector_to_geojson" class="doc doc-heading">
<code class="highlight language-python"><span class="n">vector_to_geojson</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#samgeo.common.vector_to_geojson" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Converts a vector file to a geojson file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>filename</code></td>
        <td><code>str</code></td>
        <td><p>The vector file path.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>The output geojson file path. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>dict</code></td>
      <td><p>The geojson dictionary.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>samgeo/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">vector_to_geojson</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a vector file to a geojson file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The vector file path.</span>
<span class="sd">        output (str, optional): The output geojson file path. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: The geojson dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdf</span><span class="o">.</span><span class="n">__geo_interface__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>









  </div>

    </div>

  </div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    2024-03-29
  </span>

    
    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "search.highlight"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>